import"./svelte/svelte_internal_flags_async.js";import*as e from"./svelte/svelte_internal_client.js";import"./i18n-DMKL1Q3B.js";import{G as Pe}from"./utils.svelte-Ceck75cM.js";import{createEventDispatcher as Ee,onMount as Me,tick as H}from"./svelte/svelte_svelte.js";import{e as Ae,c as Re,g as Le,h as Ne,I as ze,T as Ge,r as He,S as Ue,B as We}from"./IconButtonWrapper-BWheMLkN.js";import"./svelte/svelte_internal_flags_legacy.js";import{fade as Q}from"./svelte/svelte_transition.js";import{BaseDropdown as je,BaseDropdownOptions as ve}from"./Index-CsYOxAgl.js";import{S as qe}from"./StreamingBar-DrfQmzG9.js";import{default as Rt}from"./Example-BWoz5coS.js";import"./svelte/svelte_store.js";import"./index-BXZmp9-u.js";import"./svelte/svelte_animate.js";import"./svelte/svelte_attachments.js";import"./svelte/svelte_easing.js";import"./svelte/svelte_internal_flags_tracing.js";import"./svelte/svelte_internal_server.js";import"./svelte/svelte_legacy.js";import"./svelte/svelte_motion.js";import"./svelte/svelte_reactivity.js";import"./svelte/svelte_reactivity_window.js";import"./svelte/svelte_server.js";import"./svelte/svelte_events.js";import"./MarkdownCode-U4KoZ7qK.js";import"./prism-python-iiDAHIFD.js";import"./Example-Ctdnw0MA.js";var Fe=e.from_html('<div class="s s--slider svelte-1io85vl" style="font-size:var(--font-size-sm)px"><button role="switch" class="svelte-1io85vl"></button> <span> </span></div>');function Je(z,C){e.push(C,!1);let t=e.prop(C,"label",12),n=e.prop(C,"checked",12,!1),b=e.prop(C,"disabled",12,!1);const f=Ee();function M(m){const $=m.target.getAttribute("aria-checked");n($!=="true"),f("click",{checked:n()})}var P={get label(){return t()},set label(m){t(m),e.flush()},get checked(){return n()},set checked(m){n(m),e.flush()},get disabled(){return b()},set disabled(m){b(m),e.flush()}};e.init();var T=Fe(),_=e.child(T),x=e.sibling(_,2),h=e.child(x,!0);return e.reset(x),e.reset(T),e.template_effect(()=>{e.set_attribute(_,"aria-checked",n()),_.disabled=b(),e.set_text(h,t())}),e.event("click",_,M),e.append(z,T),e.pop(P)}var Ke=e.from_html("<div><!></div>"),Qe=e.from_html('<div class="loading-overlay svelte-1p54cvv"><div class="loading-spinner svelte-1p54cvv"></div> <div class="loading-text svelte-1p54cvv">Converting to dialogue format...</div></div>'),Ve=e.from_html('<textarea rows="1" readonly="" class="svelte-1p54cvv"></textarea>'),Xe=e.from_html('<div id="tag-menu" class="tag-menu svelte-1p54cvv"><!></div>'),Ye=e.from_html('<div><button class="add-button svelte-1p54cvv" aria-label="Add new line"><!></button></div>'),Ze=e.from_html('<div class="dialogue-line svelte-1p54cvv"><div class="speaker-column svelte-1p54cvv" role="button" tabindex="0"><!></div> <div class="text-column svelte-1p54cvv"><div class="input-container svelte-1p54cvv"><textarea rows="1" class="svelte-1p54cvv"></textarea> <!></div></div> <!> <div><button class="delete-button svelte-1p54cvv" aria-label="Remove current line"><!></button></div></div>'),et=e.from_html("<div><!> <!></div>"),tt=e.from_html('<div class="loading-overlay svelte-1p54cvv"><div class="loading-spinner svelte-1p54cvv"></div> <div class="loading-text svelte-1p54cvv">Converting to plain text...</div></div>'),st=e.from_html('<div id="tag-menu" class="tag-menu-plain-text svelte-1p54cvv"><!></div>'),rt=e.from_html('<div><!> <textarea data-testid="textbox" class="svelte-1p54cvv"></textarea> <!></div>'),at=e.from_html('<div class="submit-container svelte-1p54cvv"><button class="submit-button svelte-1p54cvv"><!></button></div>'),lt=e.from_html("<label><!> <!> <!> <!> <!></label>");function ot(z,C){e.push(C,!0),e.rest_props(C,["$$slots","$$events","$$legacy"]);const t=C.gradio;let n=e.derived(()=>!1),b=e.derived(()=>!t.shared.interactive),f=e.state(e.proxy([]));e.user_effect(()=>{t.props.value&&t.props.value.length&&typeof t.props.value!="string"?e.set(f,[...t.props.value],!0):t.props.value&&typeof t.props.value!="string"?e.set(f,[{speaker:`${t.props.speakers.length?t.props.speakers[0]:""}`,text:""}],!0):typeof t.props.value=="string"&&(e.set(w,t.props.value,!0),e.set(n,!0))});let M=e.derived(()=>t.props.buttons||["copy"]),P=e.state(e.proxy(t.props.value));e.user_effect(()=>{e.get(P)!=t.props.value&&(e.set(P,t.props.value,!0),t.dispatch("change"))});let T,_=e.state(!1),x=e.state(-1),h=e.state(0),m=e.state(e.proxy([])),I=e.proxy([]),$,se=e.state(0),U=e.state(!1),V,w=e.state(""),W=e.state(null),A=e.state(!1),R=e.state(!1);const re=["red","green","blue","yellow","purple","teal","orange","cyan","lime","pink"],ue={red:"rgba(254, 202, 202, 0.7)",green:"rgba(209, 250, 229, 0.7)",blue:"rgba(219, 234, 254, 0.7)",yellow:"rgba(254, 243, 199, 0.7)",purple:"rgba(233, 213, 255, 0.7)",teal:"rgba(204, 251, 241, 0.7)",orange:"rgba(254, 215, 170, 0.7)",cyan:"rgba(207, 250, 254, 0.7)",lime:"rgba(217, 249, 157, 0.7)",pink:"rgba(252, 231, 243, 0.7)"};let ge=e.derived(()=>{let s={};return t.props.color_map?s={...t.props.color_map}:(s={},t.props.speakers.forEach((r,a)=>{const d=re[a%re.length];s[r]=ue[d]})),s});function fe(s){const r=t.props.speakers.length>0?t.props.speakers[0]:"";e.set(f,[...e.get(f).slice(0,s+1),{speaker:r,text:""},...e.get(f).slice(s+1)],!0),H().then(()=>{I[s+1]&&I[s+1].focus()}),t.props.value=[...e.get(f)]}function _e(s){e.set(f,[...e.get(f).slice(0,s),...e.get(f).slice(s+1)],!0),t.props.value=[...e.get(f)]}function X(s,r,a){e.get(f)[s][r]=a,e.set(f,[...e.get(f)],!0),t.props.value=[...e.get(f)]}function j(s,r){const a=s.target||HTMLTextAreaElement;a&&!I[r]&&(I[r]=a);const d=a.selectionStart||0,u=a.value;let g=!1,p=-1;if(u[d-1]===":"){e.set(x,r,!0),p=d;const l=he(u,d);e.set(m,t.props.tags.filter(i=>l===""||i.toLowerCase().includes(l.toLowerCase())),!0),g=e.get(m).length>0,e.set(h,0)}else{const l=u.lastIndexOf(":",d-1);if(l>=0&&!u.substring(l+1,d).includes(" ")){e.set(x,r,!0),p=l+1;const i=u.substring(l+1,d);e.set(m,t.props.tags.filter(c=>i===""||c.toLowerCase().includes(i.toLowerCase())),!0),g=e.get(m).length>0,e.set(h,0)}}if(g&&p!==-1){e.set(_,!0);const l=a.getBoundingClientRect();if(T){const i=T.getBoundingClientRect();e.set(se,i.top+l.height*(r+1.5))}}else e.set(_,!1);t.dispatch("input")}function he(s,r){const a=s.lastIndexOf(":",r-1);return a>=0?s.substring(a+1,r):""}async function ae(){const s=e.get(m)[e.get(h)];if(s){let r,a;e.get(n)?(a=$,r=e.get(w)):(a=I[e.get(x)],r=e.get(f)[e.get(x)].text);const d=a?.selectionStart||0,u=r.lastIndexOf(":",d-1);if(u>=0){const g=r.substring(0,u),p=r.substring(d);if(e.get(n)){const l=`${g}${s} ${p}`;e.set(w,l),t.props.speakers.length===0?t.props.value=l:t.props.value=await t.shared.server.unformat({text:l}),H().then(()=>{if($){const i=g.length+s.length+1;$.setSelectionRange(i,i),$.focus()}})}else{const l=g.replace(/\[S\d+\]/g,"").trim(),i=`${l}${s} ${p}`;X(e.get(x),"text",i),H().then(()=>{const c=I[e.get(x)];if(c){const y=l.length+s.length+1;c.setSelectionRange(y,y),c.focus()}})}}e.set(_,!1),e.set(h,0)}}async function le(s){const r=t.props.tags[s.detail.target.dataset.index];if(r){let a,d;e.get(n)?(d=$,a=e.get(w)):(d=I[e.get(x)],a=e.get(f)[e.get(x)].text);const u=d?.selectionStart||0,g=a.lastIndexOf(":",u-1);if(g>=0){const p=a.substring(0,g),l=a.substring(u);if(e.get(n)){const i=`${p}${r} ${l}`;e.set(w,i),t.props.speakers.length===0?t.props.value=i:t.props.value=await t.shared.server.unformat({text:i}),H().then(()=>{if($){const c=p.length+r.length+1;$.setSelectionRange(c,c),$.focus()}})}else{const i=p.replace(/\[S\d+\]/g,"").trim(),c=`${i}${r} ${l}`;X(e.get(x),"text",c),H().then(()=>{const y=I[e.get(x)];if(y){const L=i.length+r.length+1;y.setSelectionRange(L,L),y.focus()}})}}e.set(_,!1),e.set(h,0)}}function me(s){if(e.get(_)){const r=s.target,a=document.getElementById("tag-menu");a&&!a.contains(r)&&e.set(_,!1)}}async function Y(s){return typeof s=="string"?s:await t.shared.server.format(s)}async function be(){if("clipboard"in navigator){const s=await Y(t.props.value);await navigator.clipboard.writeText(s),xe()}}function xe(){e.set(U,!0),V&&clearTimeout(V),V=setTimeout(()=>{e.set(U,!1)},1e3)}async function ke(){e.get(n)&&(t.props.value=await t.shared.server.unformat({text:e.get(w)})),t.dispatch("submit")}Me(async()=>{if(typeof t.props.value=="string")e.set(w,t.props.value,!0);else if(t.props.value&&t.props.value.length>0){const s=await Y(t.props.value);e.set(w,s,!0)}else e.set(w,"")});var q=lt();e.event("click",e.window,me);let oe;var ie=e.child(q);{var we=s=>{Re(s,{children:(r,a)=>{{let d=e.derived(()=>e.get(U)?Le:Ne),u=e.derived(()=>e.get(U)?"Copied":"Copy");ze(r,{get Icon(){return e.get(d)},get label(){return e.get(u)},$$events:{click:be}})}},$$slots:{default:!0}})};e.if(ie,s=>{t.shared.show_label&&e.get(M).includes("copy")&&s(we)})}var ne=e.sibling(ie,2);Ae(ne,{get show_label(){return t.shared.show_label},get info(){return t.props.info},children:(s,r)=>{e.next();var a=e.text();e.template_effect(()=>e.set_text(a,t.shared.label||"Dialogue")),e.append(s,a)},$$slots:{default:!0}});var pe=e.sibling(ne,2);{var ye=s=>{var r=Ke();let a;var d=e.child(r);{let u=e.derived(()=>e.get(R)||e.get(A));Je(d,{label:"Plain Text",get disabled(){return e.get(u)},get checked(){return e.get(n)},set checked(g){e.set(n,g)},$$events:{click:async g=>{if(g.detail.checked){e.set(R,!0);try{e.set(w,await Y(e.get(f)),!0)}finally{e.set(R,!1)}}else{e.set(A,!0);try{t.props.value=await t.shared.server.unformat({text:e.get(w)}),e.set(f,[...t.props.value],!0)}finally{e.set(A,!1)}}}}})}e.reset(r),e.template_effect(()=>a=e.set_class(r,1,"switch-container top-switch svelte-1p54cvv",null,a,{"switch-disabled":e.get(R)||e.get(A)})),e.append(s,r)};e.if(pe,s=>{t.props.ui_mode==="both"&&s(ye)})}var de=e.sibling(pe,2);{var $e=s=>{var r=et();let a;var d=e.child(r);{var u=p=>{var l=Qe();e.transition(3,l,()=>Q,()=>({duration:200})),e.append(p,l)};e.if(d,p=>{e.get(A)&&p(u)})}var g=e.sibling(d,2);e.each(g,17,()=>e.get(f),e.index,(p,l,i)=>{var c=Ze(),y=e.child(c),L=e.child(y);{var v=o=>{var k=Ve();e.remove_textarea_child(k),e.template_effect(()=>k.disabled=e.get(b)),e.bind_value(k,()=>e.get(l).speaker,S=>e.get(l).speaker=S),e.append(o,k)},B=o=>{{let k=e.derived(()=>t.props.speakers.map(S=>[S,S]));je(o,{label:"",show_label:!1,container:!0,interactive:!0,get value(){return e.get(l).speaker},get choices(){return e.get(k)},on_change:S=>X(i,"speaker",S)})}};e.if(L,o=>{e.get(b)?o(v):o(B,!1)})}e.reset(y);var G=e.sibling(y,2),F=e.child(G),D=e.child(F);e.remove_textarea_child(D),e.bind_this(D,(o,k)=>I[k]=o,o=>I?.[o],()=>[i]);var Z=e.sibling(D,2);{var O=o=>{var k=Xe(),S=e.child(k);{let N=e.derived(()=>t.props.tags.map((E,Oe)=>[E,Oe])),te=e.derived(()=>e.get(m).map(E=>t.props.tags.indexOf(E))),Be=e.derived(()=>e.get(m).map(E=>t.props.tags.indexOf(E))[e.get(h)]);ve(S,{get choices(){return e.get(N)},get filtered_indices(){return e.get(te)},get active_index(){return e.get(Be)},show_options:!0,get offset_from_top(){return e.get(se)},from_top:!0,$$events:{change:E=>le(E)}})}e.reset(k),e.transition(3,k,()=>Q,()=>({duration:100})),e.append(o,k)};e.if(Z,o=>{e.get(_)&&e.get(x)===i&&o(O)})}e.reset(F),e.reset(G);var J=e.sibling(G,2);{var Se=o=>{var k=Ye();let S;var N=e.child(k),te=e.child(N);He(te),e.reset(N),e.reset(k),e.template_effect(()=>{S=e.set_class(k,1,"svelte-1p54cvv",null,S,{"action-column":i==0,hidden:e.get(b)}),N.disabled=e.get(b)}),e.event("click",N,()=>fe(i)),e.append(o,k)};e.if(J,o=>{(t.props.max_lines==null||t.props.max_lines&&i<t.props.max_lines-1)&&o(Se)})}var ee=e.sibling(J,2);let ce;var K=e.child(ee),Te=e.child(K);Ge(Te),e.reset(K),e.reset(ee),e.reset(c),e.template_effect(()=>{e.set_style(c,`--speaker-bg-color: ${(e.get(b)&&(e.get(W)===null||e.get(W)===e.get(l).speaker)&&e.get(ge)[e.get(l).speaker]||"transparent")??""}`),e.set_attribute(D,"placeholder",t.props.placeholder),D.disabled=e.get(b),ce=e.set_class(ee,1,"action-column svelte-1p54cvv",null,ce,{hidden:e.get(b)||i==0}),K.disabled=e.get(b)}),e.event("mouseenter",y,()=>e.get(b)&&e.set(W,e.get(l).speaker,!0)),e.event("mouseleave",y,()=>e.get(b)&&e.set(W,null)),e.bind_value(D,()=>e.get(l).text,o=>e.get(l).text=o),e.event("input",D,o=>j(o,i)),e.event("focus",D,o=>j(o,i)),e.event("keydown",D,o=>{o.key==="Escape"&&e.get(_)?(e.set(_,!1),e.set(h,0),o.preventDefault()):e.get(_)&&e.get(x)===i&&(o.key==="ArrowDown"?(e.set(h,Math.min(e.get(h)+1,e.get(m).length-1),!0),o.preventDefault()):o.key==="ArrowUp"?(e.set(h,Math.max(e.get(h)-1,0),!0),o.preventDefault()):o.key==="Enter"&&(e.get(m)[e.get(h)]&&ae(),o.preventDefault()))}),e.event("click",K,()=>_e(i)),e.append(p,c)}),e.reset(r),e.bind_this(r,p=>T=p,()=>T),e.template_effect(()=>a=e.set_class(r,1,"dialogue-container svelte-1p54cvv",null,a,{loading:e.get(A)})),e.append(s,r)},Ce=s=>{var r=e.comment(),a=e.first_child(r);{var d=u=>{var g=rt();let p;var l=e.child(g);{var i=v=>{var B=tt();e.transition(3,B,()=>Q,()=>({duration:200})),e.append(v,B)};e.if(l,v=>{e.get(R)&&v(i)})}var c=e.sibling(l,2);e.remove_textarea_child(c),e.set_attribute(c,"rows",5),e.bind_this(c,v=>$=v,()=>$);var y=e.sibling(c,2);{var L=v=>{var B=st(),G=e.child(B);{let F=e.derived(()=>t.props.tags.map((O,J)=>[O,J])),D=e.derived(()=>e.get(m).map(O=>t.props.tags.indexOf(O))),Z=e.derived(()=>e.get(m).map(O=>t.props.tags.indexOf(O))[e.get(h)]);ve(G,{get choices(){return e.get(F)},get filtered_indices(){return e.get(D)},get active_index(){return e.get(Z)},show_options:!0,$$events:{change:O=>le(O)}})}e.reset(B),e.transition(3,B,()=>Q,()=>({duration:100})),e.append(v,B)};e.if(y,v=>{e.get(_)&&v(L)})}e.reset(g),e.template_effect(()=>{p=e.set_class(g,1,"textarea-container svelte-1p54cvv",null,p,{loading:e.get(R)}),e.set_attribute(c,"placeholder",t.props.placeholder),c.disabled=e.get(b)}),e.bind_value(c,()=>e.get(w),v=>e.set(w,v)),e.event("input",c,v=>{j(v,0),t.props.value=e.get(w)}),e.event("focus",c,v=>j(v,0)),e.event("keydown",c,v=>{v.key==="Escape"&&e.get(_)?(e.set(_,!1),e.set(h,0),v.preventDefault()):e.get(_)&&(v.key==="ArrowDown"?(e.set(h,Math.min(e.get(h)+1,e.get(m).length-1),!0),v.preventDefault()):v.key==="ArrowUp"?(e.set(h,Math.max(e.get(h)-1,0),!0),v.preventDefault()):v.key==="Enter"&&(e.get(m)[e.get(h)]&&ae(),v.preventDefault()))}),e.append(u,g)};e.if(a,u=>{(e.get(n)||t.props.ui_mode!=="dialogue")&&u(d)},!0)}e.append(s,r)};e.if(de,s=>{!e.get(n)&&t.props.ui_mode!=="text"?s($e):s(Ce,!1)})}var Ie=e.sibling(de,2);{var De=s=>{var r=at(),a=e.child(r),d=e.child(a);{var u=p=>{var l=e.text();e.template_effect(()=>e.set_text(l,t.props.submit_btn)),e.append(p,l)},g=p=>{Ue(p)};e.if(d,p=>{typeof t.props.submit_btn=="string"?p(u):p(g,!1)})}e.reset(a),e.reset(r),e.template_effect(()=>a.disabled=e.get(b)),e.event("click",a,ke),e.append(s,r)};e.if(Ie,s=>{t.props.submit_btn&&!e.get(b)&&s(De)})}e.reset(q),e.template_effect(()=>oe=e.set_class(q,1,"svelte-1p54cvv",null,oe,{container:t.shared.container})),e.append(z,q),e.pop()}var it=e.from_html("<!> <!>",1);function Et(z,C){e.push(C,!0);const t=e.rest_props(C,["$$slots","$$events","$$legacy"]),n=new Pe(t);We(z,{get visible(){return n.shared.visible},get elem_id(){return n.shared.elem_id},get elem_classes(){return n.shared.elem_classes},get scale(){return n.shared.scale},get min_width(){return n.shared.min_width},allow_overflow:!0,get padding(){return n.shared.container},children:(b,f)=>{var M=it(),P=e.first_child(M);{var T=x=>{qe(x,e.spread_props({get autoscroll(){return n.shared.autoscroll},get i18n(){return n.i18n}},()=>n.shared.loading_status,{on_clear_status:()=>n.dispatch("clear_status",n.shared.loading_status)}))};e.if(P,x=>{n.shared.loading_status&&x(T)})}var _=e.sibling(P,2);ot(_,{get gradio(){return n}}),e.append(b,M)},$$slots:{default:!0}}),e.pop()}export{ot as BaseDialogue,Rt as BaseExample,Et as default};
