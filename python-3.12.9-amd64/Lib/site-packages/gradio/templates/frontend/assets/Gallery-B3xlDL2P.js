import"./svelte/svelte_internal_flags_legacy.js";import"./svelte/svelte_internal_flags_async.js";import*as e from"./svelte/svelte_internal_client.js";import{b as Ke,d as Ue,E as Ne,c as Qe,I as ke,D as Ye,l as Be,m as Ze,n as De}from"./IconButtonWrapper-BWheMLkN.js";import{S as $e}from"./ShareButton-DLehHS0O.js";import{F as et}from"./FullscreenButton-B8JPMBMa.js";import{M as tt,U as lt}from"./ModifyUpload-CMHuWP2V.js";import{I as xe}from"./Image-Bdf4wQSw.js";import"./ImagePreview-CahJZlWj.js";import{V as ze}from"./Video-06U9X4-1.js";import{d as rt}from"./index-tFQomdd2.js";import{createEventDispatcher as at,onMount as nt,tick as it}from"./svelte/svelte_svelte.js";import"./index-BXZmp9-u.js";import"./i18n-DMKL1Q3B.js";import{u as ot}from"./utils.svelte-Ceck75cM.js";import"./MarkdownCode-U4KoZ7qK.js";import"./prism-python-iiDAHIFD.js";import"./svelte/svelte_animate.js";import"./svelte/svelte_attachments.js";import"./svelte/svelte_easing.js";import"./svelte/svelte_internal_flags_tracing.js";import"./svelte/svelte_internal_server.js";import"./svelte/svelte_legacy.js";import"./svelte/svelte_motion.js";import"./svelte/svelte_reactivity.js";import"./svelte/svelte_reactivity_window.js";import"./svelte/svelte_server.js";import"./svelte/svelte_store.js";import"./svelte/svelte_transition.js";import"./svelte/svelte_events.js";async function st(K){return K?`<div style="display: flex; flex-wrap: wrap; gap: 16px">${(await Promise.all(K.map(async([k,N])=>k===null||!k.url?"":await ot(k.url)))).map(k=>`<img src="${k}" style="height: 400px" />`).join("")}</div>`:""}var ut=e.from_html('<div class="icon-button"><!></div>'),_t=e.from_html("<!> <!> <!> <!>",1),ct=e.from_html('<caption class="caption svelte-7anmrz"> </caption>'),gt=e.from_html("<!> <!>",1),dt=e.from_html("<button><!></button>"),ft=e.from_html('<span><!> <button class="media-button svelte-7anmrz" aria-label="detailed view of selected image"><!></button> <!> <div class="thumbnails scroll-hide svelte-7anmrz" data-testid="container_el"></div></span>'),pt=e.from_html("<!> <!>",1),mt=e.from_html('<div class="caption-label svelte-7anmrz"> </div>'),vt=e.from_html('<button class="delete-button svelte-7anmrz" aria-label="Delete image"><!></button>'),ht=e.from_html('<div class="gallery-item svelte-7anmrz"><button><!> <!></button> <!></div>'),bt=e.from_html('<div class="gallery-container"><!> <div><!> <div></div></div></div>'),wt=e.from_html("<!> <!>",1);function Qt(K,r){e.push(r,!1);const k=e.mutable_source(),N=e.mutable_source(),o=e.mutable_source();let O=e.prop(r,"show_label",12,!0),oe=e.prop(r,"label",12),c=e.prop(r,"value",12,null),x=e.prop(r,"columns",28,()=>[2]),se=e.prop(r,"rows",12,void 0),B=e.prop(r,"height",12,"auto"),S=e.prop(r,"preview",12),D=e.prop(r,"allow_preview",12,!0),ue=e.prop(r,"object_fit",12,"cover"),_e=e.prop(r,"show_share_button",12,!1),ce=e.prop(r,"show_download_button",12,!1),I=e.prop(r,"i18n",12),l=e.prop(r,"selected_index",12,null),Q=e.prop(r,"interactive",12),ge=e.prop(r,"_fetch",12),R=e.prop(r,"mode",12,"normal"),de=e.prop(r,"show_fullscreen_button",12,!0),fe=e.prop(r,"display_icon_button_wrapper_top_corner",12,!1),pe=e.prop(r,"fullscreen",12,!1),me=e.prop(r,"root",12,""),ve=e.prop(r,"file_types",28,()=>["image","video"]),he=e.prop(r,"max_file_size",12,null),Y=e.prop(r,"upload",12,void 0),Z=e.prop(r,"stream_handler",12,void 0),$=e.prop(r,"fit_columns",12,!0),ee=e.prop(r,"upload_promise",12,null),be=e.mutable_source(!1),qe=e.mutable_source();const L=at();let T=e.mutable_source(!0),a=e.mutable_source(null),te=e.mutable_source(x()),we=e.mutable_source(c());l()==null&&S()&&c()?.length&&l(0);let ye=e.mutable_source(l());function Re(t){const _=t.target,f=t.offsetX,w=_.offsetWidth/2;f<w?l(e.get(k)):l(e.get(N))}function Te(t){switch(t.code){case"Escape":t.preventDefault(),l(null);break;case"ArrowLeft":t.preventDefault(),l(e.get(k));break;case"ArrowRight":t.preventDefault(),l(e.get(N));break}}let A=e.mutable_source([]),h=e.mutable_source();async function Ae(t){if(typeof t!="number"||(await it(),e.get(A)[t]===void 0))return;e.get(A)[t]?.focus();const{left:_,width:f}=e.get(h).getBoundingClientRect(),{left:C,width:w}=e.get(A)[t].getBoundingClientRect(),j=C-_+w/2-f/2+e.get(h).scrollLeft;e.get(h)&&typeof e.get(h).scrollTo=="function"&&e.get(h).scrollTo({left:j<0?0:j,behavior:"smooth"})}let Ce=e.mutable_source(0);async function We(t,_){let f;try{f=await ge()(t)}catch(j){if(j instanceof TypeError){window.open(t,"_blank","noreferrer");return}throw j}const C=await f.blob(),w=URL.createObjectURL(C),U=document.createElement("a");U.href=w,U.download=_,U.click(),URL.revokeObjectURL(w)}let Ee=e.mutable_source(!1);function V(){e.get(h)&&e.set(Ee,e.get(h).scrollWidth>e.get(h).clientWidth)}nt(()=>(V(),document.addEventListener("fullscreenchange",()=>{e.set(be,!!document.fullscreenElement)}),window.addEventListener("resize",V),()=>window.removeEventListener("resize",V)));function Fe(t){if(!c()||!e.get(a))return;const _=e.get(a)[t];let f;"image"in _?f={file:_.image,index:t}:"video"in _&&(f={file:_.video,index:t}),f&&L("delete",f)}let Ie=e.mutable_source(!1);e.legacy_pre_effect(()=>(e.get(T),e.deep_read_state(c())),()=>{e.set(T,c()==null||c().length===0?!0:e.get(T))}),e.legacy_pre_effect(()=>e.deep_read_state(c()),()=>{e.set(a,c()==null?null:c().map(t=>"video"in t?{video:t.video,caption:t.caption}:"image"in t?{image:t.image,caption:t.caption}:{}))}),e.legacy_pre_effect(()=>(e.get(a),e.deep_read_state(x()),e.deep_read_state($())),()=>{if(e.get(a)&&x()&&$()){const t=e.get(a).length;Array.isArray(x())?e.set(te,x().map(_=>Math.min(_,t))):e.set(te,Math.min(x(),t))}else e.set(te,x())}),e.legacy_pre_effect(()=>(e.get(we),e.deep_read_state(c()),e.get(T),e.deep_read_state(l()),e.deep_read_state(S())),()=>{rt(e.get(we),c())||(e.get(T)?(l(S()&&c()?.length?0:null),e.set(T,!1)):l()!==null&&c()!==null?l(Math.max(0,Math.min(l(),c().length-1))):l(null),L("change"),e.set(we,c()))}),e.legacy_pre_effect(()=>(e.deep_read_state(l()),e.get(ye),e.get(a)),()=>{l()!==e.get(ye)&&(e.set(ye,l()),l()!==null&&(e.get(a)!=null&&l(Math.max(0,Math.min(l(),e.get(a).length-1))),L("select",{index:l(),value:e.get(a)?.[l()]})))}),e.legacy_pre_effect(()=>(e.deep_read_state(l()),e.get(a)),()=>{e.set(k,((l()??0)+(e.get(a)?.length??0)-1)%(e.get(a)?.length??0))}),e.legacy_pre_effect(()=>(e.deep_read_state(l()),e.get(a)),()=>{e.set(N,((l()??0)+1)%(e.get(a)?.length??0))}),e.legacy_pre_effect(()=>(e.deep_read_state(D()),e.deep_read_state(l())),()=>{D()&&Ae(l())}),e.legacy_pre_effect(()=>(e.deep_read_state(l()),e.get(a)),()=>{e.set(o,l()!=null&&e.get(a)!=null?e.get(a)[l()]:null)}),e.legacy_pre_effect(()=>e.get(a),()=>{e.get(a),V()}),e.legacy_pre_effect(()=>e.get(h),()=>{e.get(h)&&V()}),e.legacy_pre_effect_reset();var Ge={get show_label(){return O()},set show_label(t){O(t),e.flush()},get label(){return oe()},set label(t){oe(t),e.flush()},get value(){return c()},set value(t){c(t),e.flush()},get columns(){return x()},set columns(t){x(t),e.flush()},get rows(){return se()},set rows(t){se(t),e.flush()},get height(){return B()},set height(t){B(t),e.flush()},get preview(){return S()},set preview(t){S(t),e.flush()},get allow_preview(){return D()},set allow_preview(t){D(t),e.flush()},get object_fit(){return ue()},set object_fit(t){ue(t),e.flush()},get show_share_button(){return _e()},set show_share_button(t){_e(t),e.flush()},get show_download_button(){return ce()},set show_download_button(t){ce(t),e.flush()},get i18n(){return I()},set i18n(t){I(t),e.flush()},get selected_index(){return l()},set selected_index(t){l(t),e.flush()},get interactive(){return Q()},set interactive(t){Q(t),e.flush()},get _fetch(){return ge()},set _fetch(t){ge(t),e.flush()},get mode(){return R()},set mode(t){R(t),e.flush()},get show_fullscreen_button(){return de()},set show_fullscreen_button(t){de(t),e.flush()},get display_icon_button_wrapper_top_corner(){return fe()},set display_icon_button_wrapper_top_corner(t){fe(t),e.flush()},get fullscreen(){return pe()},set fullscreen(t){pe(t),e.flush()},get root(){return me()},set root(t){me(t),e.flush()},get file_types(){return ve()},set file_types(t){ve(t),e.flush()},get max_file_size(){return he()},set max_file_size(t){he(t),e.flush()},get upload(){return Y()},set upload(t){Y(t),e.flush()},get stream_handler(){return Z()},set stream_handler(t){Z(t),e.flush()},get fit_columns(){return $()},set fit_columns(t){$(t),e.flush()},get upload_promise(){return ee()},set upload_promise(t){ee(t),e.flush()}};e.init();var Le=wt(),je=e.first_child(Le);{var He=t=>{{let _=e.derived_safe_equal(()=>oe()||"Gallery");Ke(t,{get show_label(){return O()},get Icon(){return Ue},get label(){return e.get(_)}})}};e.if(je,t=>{O()&&t(He)})}var Oe=e.sibling(je,2);{var Se=t=>{Ne(t,{unpadded_box:!0,size:"large",children:(_,f)=>{Ue(_)},$$slots:{default:!0}})},Ve=t=>{var _=bt(),f=e.child(_);{var C=y=>{var s=ft();let z;var q=e.child(s);Qe(q,{get display_top_corner(){return fe()},children:(g,u)=>{var n=_t(),i=e.first_child(n);{var v=d=>{{let E=e.derived_safe_equal(()=>(e.deep_read_state(I()),e.untrack(()=>I()("common.download"))));ke(d,{get Icon(){return Ye},get label(){return e.get(E)},$$events:{click:()=>{const ie="image"in e.get(o)?e.get(o)?.image:e.get(o)?.video;if(ie==null)return;const{url:H,orig_name:Je}=ie;H&&We(H,Je??"image")}}})}};e.if(i,d=>{ce()&&d(v)})}var G=e.sibling(i,2);{var J=d=>{et(d,{get fullscreen(){return pe()},$$events:{fullscreen(E){e.bubble_event.call(this,r,E)}}})};e.if(G,d=>{de()&&d(J)})}var ae=e.sibling(G,2);{var b=d=>{var E=ut(),ie=e.child(E);$e(ie,{get i18n(){return I()},get value(){return e.get(a)},get formatter(){return st},$$events:{share(H){e.bubble_event.call(this,r,H)},error(H){e.bubble_event.call(this,r,H)}}}),e.reset(E),e.append(d,E)};e.if(ae,d=>{_e()&&d(b)})}var P=e.sibling(ae,2);{var ne=d=>{ke(d,{get Icon(){return Be},label:"Close",$$events:{click:()=>{l(null),L("preview_close")}}})};e.if(P,d=>{e.get(be)||d(ne)})}e.append(g,n)},$$slots:{default:!0}});var p=e.sibling(q,2),W=e.child(p);{var M=g=>{{let u=e.derived_safe_equal(()=>(e.get(o),e.untrack(()=>({alt:e.get(o).caption||"",title:e.get(o).caption||null,class:e.get(o).caption&&"with-caption",loading:"lazy"}))));xe(g,{get restProps(){return e.get(u)},get src(){return e.get(o),e.untrack(()=>e.get(o).image.url)},data_testid:"detailed-image"})}},X=g=>{{let u=e.derived_safe_equal(()=>(e.get(o),e.untrack(()=>e.get(o).caption||"")));ze(g,{get src(){return e.get(o),e.untrack(()=>e.get(o).video.url)},"data-testid":"detailed-video",get alt(){return e.get(u)},loading:"lazy",loop:!1,is_stream:!1,muted:!1,controls:!0})}};e.if(W,g=>{"image"in e.get(o)?g(M):g(X,!1)})}e.reset(p);var F=e.sibling(p,2);{var re=g=>{var u=ct(),n=e.child(u,!0);e.reset(u),e.template_effect(()=>e.set_text(n,(e.get(o),e.untrack(()=>e.get(o).caption)))),e.append(g,u)};e.if(F,g=>{e.get(o),e.untrack(()=>e.get(o)?.caption)&&g(re)})}var m=e.sibling(F,2);e.each(m,5,()=>e.get(a),e.index,(g,u,n)=>{var i=dt();let v;var G=e.child(i);{var J=b=>{{let P=e.derived_safe_equal(()=>(e.get(u),e.untrack(()=>({title:e.get(u).caption||null,alt:"",class:"with-caption",loading:"lazy"}))));xe(b,{get src(){return e.get(u),e.untrack(()=>e.get(u).image.url)},get restProps(){return e.get(P)},data_testid:`thumbnail ${n+1}`})}},ae=b=>{var P=gt(),ne=e.first_child(P);De(ne);var d=e.sibling(ne,2);{let E=e.derived_safe_equal(()=>(e.get(u),e.untrack(()=>e.get(u).caption||null)));ze(d,{get src(){return e.get(u),e.untrack(()=>e.get(u).video.url)},get title(){return e.get(E)},is_stream:!1,"data-testid":"thumbnail "+(n+1),alt:"",loading:"lazy",loop:!1})}e.append(b,P)};e.if(G,b=>{"image"in e.get(u)?b(J):b(ae,!1)})}e.reset(i),e.bind_this(i,(b,P)=>e.mutate(A,e.get(A)[P]=b),b=>e.get(A)?.[b],()=>[n]),e.template_effect(()=>{v=e.set_class(i,1,"thumbnail-item thumbnail-small svelte-7anmrz",null,v,{selected:l()===n&&R()!=="minimal"}),e.set_attribute(i,"aria-label",(e.get(a),e.untrack(()=>"Thumbnail "+(n+1)+" of "+e.get(a).length)))}),e.event("click",i,()=>l(n)),e.append(g,i)}),e.reset(m),e.bind_this(m,g=>e.set(h,g),()=>e.get(h)),e.reset(s),e.template_effect(()=>{z=e.set_class(s,1,"preview svelte-7anmrz",null,z,{minimal:R()==="minimal"}),e.set_style(p,`height: calc(100% - ${e.get(o),e.untrack(()=>e.get(o).caption?"80px":"60px")??""})`),e.set_style(m,`justify-content: ${e.get(Ee)?"flex-start":"center"};`)}),e.event("click",p,function(...g){("image"in e.get(o)?u=>Re(u):null)?.apply(this,g)}),e.event("keydown",s,Te),e.append(y,s)};e.if(f,y=>{e.get(o)&&D()&&y(C)})}var w=e.sibling(f,2);let U,j;var Me=e.child(w);{var Xe=y=>{tt(y,{get i18n(){return I()},$$events:{clear:()=>{c([]),L("clear")}},children:(s,z)=>{var q=e.comment(),p=e.first_child(q);{var W=M=>{{let X=e.derived_safe_equal(()=>(e.deep_read_state(I()),e.untrack(()=>I()("common.upload"))));ke(M,{get Icon(){return Ze},get label(){return e.get(X)},children:(F,re)=>{lt(F,{icon_upload:!0,get filetype(){return ve()},file_count:"multiple",get max_file_size(){return he()},get root(){return me()},get stream_handler(){return Z()},get upload(){return Y()},get upload_promise(){return ee()},set upload_promise(m){ee(m)},get uploading(){return e.get(Ie)},set uploading(m){e.set(Ie,m)},$$events:{load:m=>L("upload",m.detail),error:m=>L("error",m.detail)},$$legacy:!0})},$$slots:{default:!0}})}};e.if(p,M=>{Y()&&Z()&&M(W)})}e.append(s,q)},$$slots:{default:!0}})};e.if(Me,y=>{Q()&&l()===null&&y(Xe)})}var le=e.sibling(Me,2);let Pe;e.each(le,5,()=>e.get(a),e.index,(y,s,z)=>{var q=ht(),p=e.child(q);let W;var M=e.child(p);{var X=n=>{{let i=e.derived_safe_equal(()=>(e.get(s),e.untrack(()=>e.get(s).caption||""))),v=e.derived_safe_equal(()=>(e.get(s),e.untrack(()=>typeof e.get(s).image=="string"?e.get(s).image:e.get(s).image.url)));xe(n,{get alt(){return e.get(i)},get src(){return e.get(v)},loading:"lazy"})}},F=n=>{var i=pt(),v=e.first_child(i);De(v);var G=e.sibling(v,2);{let J=e.derived_safe_equal(()=>(e.get(s),e.untrack(()=>e.get(s).caption||null)));ze(G,{get src(){return e.get(s),e.untrack(()=>e.get(s).video.url)},get title(){return e.get(J)},is_stream:!1,"data-testid":"thumbnail "+(z+1),alt:"",loading:"lazy",loop:!1})}e.append(n,i)};e.if(M,n=>{"image"in e.get(s)?n(X):n(F,!1)})}var re=e.sibling(M,2);{var m=n=>{var i=mt(),v=e.child(i,!0);e.reset(i),e.template_effect(()=>e.set_text(v,(e.get(s),e.untrack(()=>e.get(s).caption)))),e.append(n,i)};e.if(re,n=>{e.get(s),e.untrack(()=>e.get(s).caption)&&n(m)})}e.reset(p);var g=e.sibling(p,2);{var u=n=>{var i=vt(),v=e.child(i);Be(v),e.reset(i),e.event("click",i,e.stopPropagation(()=>Fe(z))),e.append(n,i)};e.if(g,n=>{Q()&&n(u)})}e.reset(q),e.template_effect(()=>{W=e.set_class(p,1,"thumbnail-item thumbnail-lg svelte-7anmrz",null,W,{selected:l()===z}),e.set_attribute(p,"aria-label",(e.get(a),e.untrack(()=>"Thumbnail "+(z+1)+" of "+e.get(a).length)))}),e.event("click",p,()=>{l()===null&&D()&&L("preview_open"),l(z)}),e.append(y,q)}),e.reset(le),e.reset(w),e.reset(_),e.bind_this(_,y=>e.set(qe,y),()=>e.get(qe)),e.template_effect(()=>{U=e.set_class(w,1,"grid-wrap svelte-7anmrz",null,U,{minimal:R()==="minimal","fixed-height":R()!=="minimal"&&(!B()||B()=="auto"),hidden:e.get(be)}),j=e.set_style(w,"",j,{height:B()!=="auto"?B()+"px":null}),Pe=e.set_class(le,1,"grid-container svelte-7anmrz",null,Pe,{"pt-6":O()}),e.set_style(le,`--grid-cols:${e.get(te)??""}; --grid-rows:${se()??""}; --object-fit: ${ue()??""};`)}),e.append(t,_)};e.if(Oe,t=>{e.deep_read_state(c()),e.get(a),e.untrack(()=>c()==null||e.get(a)==null||e.get(a).length===0)?t(Se):t(Ve,!1)})}return e.bind_window_size("innerHeight",t=>e.set(Ce,t)),e.append(K,Le),e.pop(Ge)}export{Qt as default};
