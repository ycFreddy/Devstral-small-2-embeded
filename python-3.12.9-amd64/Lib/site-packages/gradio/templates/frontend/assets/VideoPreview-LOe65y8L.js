import"./svelte/svelte_internal_flags_legacy.js";import"./svelte/svelte_internal_flags_async.js";import*as e from"./svelte/svelte_internal_client.js";import{onMount as Z,onDestroy as ue,createEventDispatcher as te,afterUpdate as _e,tick as ce}from"./svelte/svelte_svelte.js";import{I as $,f as re,w as ge,a as ve,n as he,x as fe,b as me,V as ee,E as pe,c as be,j as ye,D as we}from"./IconButtonWrapper-BWheMLkN.js";import{S as ke}from"./ShareButton-DLehHS0O.js";import"./i18n-DMKL1Q3B.js";import{f as G,u as xe}from"./utils.svelte-Ceck75cM.js";import{b as Ee,t as Te,V as De}from"./Video-06U9X4-1.js";import{M as Ve}from"./ModifyUpload-CMHuWP2V.js";import{p as Pe}from"./index-BXZmp9-u.js";var Le=e.from_html('<div class="load-wrap svelte-mctcyk"><span aria-label="loading timeline" class="loader svelte-mctcyk"></span></div>'),Re=e.from_html('<img draggable="false" class="svelte-mctcyk"/>'),Se=e.from_html('<div id="timeline" class="thumbnail-wrapper svelte-mctcyk"><button aria-label="start drag handle for trimming video" class="handle left svelte-mctcyk"></button> <div class="opaque-layer svelte-mctcyk"></div> <!> <button aria-label="end drag handle for trimming video" class="handle right svelte-mctcyk"></button></div>'),Me=e.from_html('<div class="container svelte-mctcyk"><!></div>');function qe(W,r){e.push(r,!1);let a=e.prop(r,"videoElement",12),y=e.prop(r,"trimmedDuration",12),V=e.prop(r,"dragStart",12),o=e.prop(r,"dragEnd",12),P=e.prop(r,"loadingTimeline",12),x=e.mutable_source([]),w=10,f,u=e.mutable_source(0),c=e.mutable_source(100),m=null;const E=t=>{m=t},L=()=>{m=null},g=(t,s)=>{if(m){const _=document.getElementById("timeline");if(!_)return;const p=_.getBoundingClientRect();let T=(t.clientX-p.left)/p.width*100;if(s?T=m==="left"?e.get(u)+s:e.get(c)+s:T=(t.clientX-p.left)/p.width*100,T=Math.max(0,Math.min(T,100)),m==="left"){e.set(u,Math.min(T,e.get(c)));const d=e.get(u)/100*f;a(a().currentTime=d,!0),V(d)}else if(m==="right"){e.set(c,Math.max(T,e.get(u)));const d=e.get(c)/100*f;a(a().currentTime=d,!0),o(d)}const q=e.get(u)/100*f,S=e.get(c)/100*f;y(S-q),e.set(u,e.get(u)),e.set(c,e.get(c))}},I=t=>{if(m){const s=1/f*100;t.key==="ArrowLeft"?g({clientX:0},-s):t.key==="ArrowRight"&&g({clientX:0},s)}},C=()=>{const t=document.createElement("canvas"),s=t.getContext("2d");if(!s)return;t.width=a().videoWidth,t.height=a().videoHeight,s.drawImage(a(),0,0,t.width,t.height);const _=t.toDataURL("image/jpeg",.7);e.set(x,[...e.get(x),_])};Z(()=>{const t=()=>{f=a().duration;const s=f/w;let _=0;const p=()=>{C(),_++,_<w?a(a().currentTime+=s,!0):a().removeEventListener("seeked",p)};a().addEventListener("seeked",p),a(a().currentTime=0,!0)};a().readyState>=1?t():a().addEventListener("loadedmetadata",t)}),ue(()=>{window.removeEventListener("mousemove",g),window.removeEventListener("mouseup",L),window.removeEventListener("keydown",I)}),Z(()=>{window.addEventListener("mousemove",g),window.addEventListener("mouseup",L),window.addEventListener("keydown",I)}),e.legacy_pre_effect(()=>e.get(x),()=>{P(e.get(x).length!==w)}),e.legacy_pre_effect_reset();var A={get videoElement(){return a()},set videoElement(t){a(t),e.flush()},get trimmedDuration(){return y()},set trimmedDuration(t){y(t),e.flush()},get dragStart(){return V()},set dragStart(t){V(t),e.flush()},get dragEnd(){return o()},set dragEnd(t){o(t),e.flush()},get loadingTimeline(){return P()},set loadingTimeline(t){P(t),e.flush()}};e.init();var R=Me(),z=e.child(R);{var v=t=>{var s=Le();e.append(t,s)},h=t=>{var s=Se(),_=e.child(s),p=e.sibling(_,2),T=e.sibling(p,2);e.each(T,1,()=>e.get(x),e.index,(S,d,n)=>{var k=Re();e.set_attribute(k,"alt",`frame-${n}`),e.template_effect(()=>e.set_attribute(k,"src",e.get(d))),e.append(S,k)});var q=e.sibling(T,2);e.reset(s),e.template_effect(()=>{e.set_style(_,`left: ${e.get(u)??""}%;`),e.set_style(p,`left: ${e.get(u)??""}%; right: ${100-e.get(c)}%`),e.set_style(q,`left: ${e.get(c)??""}%;`)}),e.event("mousedown",_,()=>E("left")),e.event("blur",_,L),e.event("keydown",_,S=>{(S.key==="ArrowLeft"||S.key=="ArrowRight")&&E("left")}),e.event("mousedown",q,()=>E("right")),e.event("blur",q,L),e.event("keydown",q,S=>{(S.key==="ArrowLeft"||S.key=="ArrowRight")&&E("right")}),e.append(t,s)};e.if(z,t=>{P()?t(v):t(h,!1)})}return e.reset(R),e.append(W,R),e.pop(A)}var Ae=e.from_html('<div class="timeline-wrapper svelte-1orxdv"><!></div>'),Be=e.from_html('<time aria-label="duration of selected region in seconds"> </time> <div class="edit-buttons svelte-1orxdv"><button>Trim</button> <button>Cancel</button></div>',1),Ie=e.from_html('<div class="svelte-1orxdv"></div>'),Xe=e.from_html("<!> <!>",1),Ce=e.from_html('<div><!> <div class="controls svelte-1orxdv" data-testid="waveform-controls"><!></div></div> <!>',1);function He(W,r){e.push(r,!1);let a=e.prop(r,"videoElement",12),y=e.prop(r,"showRedo",12,!1),V=e.prop(r,"interactive",12,!0),o=e.prop(r,"mode",12,""),P=e.prop(r,"handle_reset_value",12),x=e.prop(r,"handle_trim_video",12),w=e.prop(r,"processingVideo",12,!1),f=e.prop(r,"i18n",12),u=e.prop(r,"value",12,null),c=e.prop(r,"show_download_button",12,!1),m=e.prop(r,"handle_clear",12,()=>{}),E=e.prop(r,"has_change_history",12,!1),L=e.mutable_source();Z(async()=>{e.set(L,await Ee())});let g=e.mutable_source(null),I=e.mutable_source(0),C=e.mutable_source(0),A=e.mutable_source(!1);const R=()=>{o()==="edit"?(o(""),e.set(g,a().duration)):o("edit")};e.legacy_pre_effect(()=>(e.deep_read_state(o()),e.get(g),e.deep_read_state(a())),()=>{o()==="edit"&&e.get(g)===null&&a()&&e.set(g,a().duration)}),e.legacy_pre_effect_reset();var z={get videoElement(){return a()},set videoElement(n){a(n),e.flush()},get showRedo(){return y()},set showRedo(n){y(n),e.flush()},get interactive(){return V()},set interactive(n){V(n),e.flush()},get mode(){return o()},set mode(n){o(n),e.flush()},get handle_reset_value(){return P()},set handle_reset_value(n){P(n),e.flush()},get handle_trim_video(){return x()},set handle_trim_video(n){x(n),e.flush()},get processingVideo(){return w()},set processingVideo(n){w(n),e.flush()},get i18n(){return f()},set i18n(n){f(n),e.flush()},get value(){return u()},set value(n){u(n),e.flush()},get show_download_button(){return c()},set show_download_button(n){c(n),e.flush()},get handle_clear(){return m()},set handle_clear(n){m(n),e.flush()},get has_change_history(){return E()},set has_change_history(n){E(n),e.flush()}};e.init();var v=Ce(),h=e.first_child(v);let t;var s=e.child(h);{var _=n=>{var k=Ae(),X=e.child(k);qe(X,{get videoElement(){return a()},get dragStart(){return e.get(I)},set dragStart(b){e.set(I,b)},get dragEnd(){return e.get(C)},set dragEnd(b){e.set(C,b)},get trimmedDuration(){return e.get(g)},set trimmedDuration(b){e.set(g,b)},get loadingTimeline(){return e.get(A)},set loadingTimeline(b){e.set(A,b)},$$legacy:!0}),e.reset(k),e.append(n,k)};e.if(s,n=>{o()==="edit"&&n(_)})}var p=e.sibling(s,2),T=e.child(p);{var q=n=>{var k=Be(),X=e.first_child(k);let b;var D=e.child(X,!0);e.reset(X);var M=e.sibling(X,2),H=e.child(M);let j;var B=e.sibling(H,2);let U;e.reset(M),e.template_effect(J=>{b=e.set_class(X,1,"svelte-1orxdv",null,b,{hidden:e.get(A)}),e.set_text(D,J),j=e.set_class(H,1,"text-button svelte-1orxdv",null,j,{hidden:e.get(A)}),U=e.set_class(B,1,"text-button svelte-1orxdv",null,U,{hidden:e.get(A)})},[()=>(e.deep_read_state(G),e.get(g),e.untrack(()=>G(e.get(g))))]),e.event("click",H,()=>{o(""),w(!0),Te(e.get(L),e.get(I),e.get(C),a()).then(J=>{x()(J)}).then(()=>{w(!1)})}),e.event("click",B,R),e.append(n,k)},S=n=>{var k=Ie();e.append(n,k)};e.if(T,n=>{o()==="edit"&&e.get(g)!==null?n(q):n(S,!1)})}e.reset(p),e.reset(h);var d=e.sibling(h,2);{let n=e.derived_safe_equal(()=>(e.deep_read_state(c()),e.deep_read_state(u()),e.untrack(()=>c()?u()?.url:null)));Ve(d,{get i18n(){return f()},get download(){return e.get(n)},$$events:{clear:()=>m()()},children:(k,X)=>{var b=Xe(),D=e.first_child(b);{var M=B=>{{let U=e.derived_safe_equal(()=>w()||!E());$(B,{get Icon(){return re},label:"Reset video to initial value",get disabled(){return e.get(U)},$$events:{click:()=>{P()(),o("")}}})}};e.if(D,B=>{y()&&o()===""&&B(M)})}var H=e.sibling(D,2);{var j=B=>{$(B,{get Icon(){return ge},label:"Trim video to selection",get disabled(){return w()},$$events:{click:R}})};e.if(H,B=>{V()&&o()===""&&B(j)})}e.append(k,b)},$$slots:{default:!0}})}return e.template_effect(()=>t=e.set_class(h,1,"container svelte-1orxdv",null,t,{hidden:o()!=="edit"})),e.append(W,v),e.pop(z)}var Ue=e.from_html('<track kind="captions" default/>'),je=e.from_html('<div class="wrap svelte-1k28h7x"><div><!></div> <div class="controls svelte-1k28h7x"><div class="inner svelte-1k28h7x"><span role="button" tabindex="0" class="icon svelte-1k28h7x" aria-label="play-pause-replay-button"><!></span> <span class="time svelte-1k28h7x"> </span>  <progress class="svelte-1k28h7x"></progress> <div role="button" tabindex="0" class="icon svelte-1k28h7x" aria-label="full-screen"><!></div></div></div></div> <!>',1);function Fe(W,r){e.push(r,!1);let a=e.prop(r,"root",12,""),y=e.prop(r,"src",12),V=e.prop(r,"subtitle",12,null),o=e.prop(r,"mirror",12),P=e.prop(r,"autoplay",12),x=e.prop(r,"loop",12),w=e.prop(r,"label",12,"test"),f=e.prop(r,"interactive",12,!1),u=e.prop(r,"handle_change",12,()=>{}),c=e.prop(r,"handle_reset_value",12,()=>{}),m=e.prop(r,"upload",12),E=e.prop(r,"is_stream",12),L=e.prop(r,"i18n",12),g=e.prop(r,"show_download_button",12,!1),I=e.prop(r,"value",12,null),C=e.prop(r,"handle_clear",12,()=>{}),A=e.prop(r,"has_change_history",12,!1),R=e.prop(r,"playback_position",12,0);const z=te();let v=e.mutable_source(0),h=e.mutable_source(),t=e.mutable_source(!0),s=e.mutable_source(),_=e.mutable_source(!1);function p(l){if(!e.get(h))return;if(l.type==="click"){q(l);return}if(l.type!=="touchmove"&&!(l.buttons&1))return;const i=l.type==="touchmove"?l.touches[0].clientX:l.clientX,{left:F,right:O}=l.currentTarget.getBoundingClientRect();e.set(v,e.get(h)*(i-F)/(O-F))}async function T(){document.fullscreenElement!=e.get(s)&&(e.get(s).currentTime>0&&!e.get(s).paused&&!e.get(s).ended&&e.get(s).readyState>e.get(s).HAVE_CURRENT_DATA?e.get(s).pause():await e.get(s).play())}function q(l){const{left:i,right:F}=l.currentTarget.getBoundingClientRect();e.set(v,e.get(h)*(l.clientX-i)/(F-i))}function S(){z("stop"),z("end")}const d=async l=>{let i=new File([l],"video.mp4");const F=await Pe([i]);let O=(await m()(F,a()))?.filter(Boolean)[0];u()(O)};function n(){e.get(s).requestFullscreen()}e.legacy_pre_effect(()=>e.get(v),()=>{e.set(v,e.get(v)||0)}),e.legacy_pre_effect(()=>e.get(h),()=>{e.set(h,e.get(h)||0)}),e.legacy_pre_effect(()=>e.get(v),()=>{R(e.get(v))}),e.legacy_pre_effect(()=>(e.deep_read_state(R()),e.get(v),e.get(s)),()=>{R()!==e.get(v)&&e.get(s)&&e.mutate(s,e.get(s).currentTime=R())}),e.legacy_pre_effect_reset();var k={get root(){return a()},set root(l){a(l),e.flush()},get src(){return y()},set src(l){y(l),e.flush()},get subtitle(){return V()},set subtitle(l){V(l),e.flush()},get mirror(){return o()},set mirror(l){o(l),e.flush()},get autoplay(){return P()},set autoplay(l){P(l),e.flush()},get loop(){return x()},set loop(l){x(l),e.flush()},get label(){return w()},set label(l){w(l),e.flush()},get interactive(){return f()},set interactive(l){f(l),e.flush()},get handle_change(){return u()},set handle_change(l){u(l),e.flush()},get handle_reset_value(){return c()},set handle_reset_value(l){c(l),e.flush()},get upload(){return m()},set upload(l){m(l),e.flush()},get is_stream(){return E()},set is_stream(l){E(l),e.flush()},get i18n(){return L()},set i18n(l){L(l),e.flush()},get show_download_button(){return g()},set show_download_button(l){g(l),e.flush()},get value(){return I()},set value(l){I(l),e.flush()},get handle_clear(){return C()},set handle_clear(l){C(l),e.flush()},get has_change_history(){return A()},set has_change_history(l){A(l),e.flush()},get playback_position(){return R()},set playback_position(l){R(l),e.flush()}};e.init();var X=je(),b=e.first_child(X),D=e.child(b);let M;var H=e.child(D);{let l=e.derived_safe_equal(()=>`${w()}-player`);De(H,{get src(){return y()},preload:"auto",get autoplay(){return P()},get loop(){return x()},get is_stream(){return E()},get"data-testid"(){return e.get(l)},get processingVideo(){return e.get(_)},get currentTime(){return e.get(v)},set currentTime(i){e.set(v,i)},get duration(){return e.get(h)},set duration(i){e.set(h,i)},get paused(){return e.get(t)},set paused(i){e.set(t,i)},get node(){return e.get(s)},set node(i){e.set(s,i)},$$events:{click:T,play(i){e.bubble_event.call(this,r,i)},pause(i){e.bubble_event.call(this,r,i)},error(i){e.bubble_event.call(this,r,i)},ended:S,loadstart(i){e.bubble_event.call(this,r,i)},loadeddata(i){e.bubble_event.call(this,r,i)},loadedmetadata(i){e.bubble_event.call(this,r,i)}},children:(i,F)=>{var O=Ue();e.template_effect(()=>e.set_attribute(O,"src",V())),e.append(i,O)},$$slots:{default:!0},$$legacy:!0})}e.reset(D);var j=e.sibling(D,2),B=e.child(j),U=e.child(B),J=e.child(U);{var le=l=>{re(l)},ae=l=>{var i=e.comment(),F=e.first_child(i);{var O=N=>{he(N)},de=N=>{fe(N)};e.if(F,N=>{e.get(t)?N(O):N(de,!1)},!0)}e.append(l,i)};e.if(J,l=>{e.get(v)===e.get(h)?l(le):l(ae,!1)})}e.reset(U);var Y=e.sibling(U,2),ne=e.child(Y);e.reset(Y);var K=e.sibling(Y,2),Q=e.sibling(K,2),se=e.child(Q);ve(se),e.reset(Q),e.reset(B),e.reset(j),e.reset(b);var ie=e.sibling(b,2);{var oe=l=>{He(l,{get videoElement(){return e.get(s)},showRedo:!0,handle_trim_video:d,get handle_reset_value(){return c()},get value(){return I()},get i18n(){return L()},get show_download_button(){return g()},get handle_clear(){return C()},get has_change_history(){return A()},get processingVideo(){return e.get(_)},set processingVideo(i){e.set(_,i)},$$legacy:!0})};e.if(ie,l=>{f()&&l(oe)})}return e.template_effect((l,i)=>{M=e.set_class(D,1,"mirror-wrap svelte-1k28h7x",null,M,{mirror:o()}),e.set_text(ne,`${l??""} / ${i??""}`),e.set_value(K,e.get(v)/e.get(h)||0)},[()=>(e.deep_read_state(G),e.get(v),e.untrack(()=>G(e.get(v)))),()=>(e.deep_read_state(G),e.get(h),e.untrack(()=>G(e.get(h))))]),e.event("click",U,T),e.event("keydown",U,T),e.event("mousemove",K,p),e.event("touchmove",K,e.preventDefault(p)),e.event("click",K,e.preventDefault(e.stopPropagation(q))),e.event("click",Q,n),e.event("keypress",Q,n),e.append(W,X),e.pop(k)}var ze=e.from_html("<!> <!>",1),Oe=e.from_html('<!> <div data-testid="download-div"><!></div>',1),We=e.from_html("<!> <!>",1);function Ne(W,r){e.push(r,!1);let a=e.prop(r,"value",12,null),y=e.prop(r,"subtitle",12,null),V=e.prop(r,"label",12,void 0),o=e.prop(r,"show_label",12,!0),P=e.prop(r,"autoplay",12),x=e.prop(r,"show_share_button",12,!0),w=e.prop(r,"show_download_button",12,!0),f=e.prop(r,"loop",12),u=e.prop(r,"i18n",12),c=e.prop(r,"upload",12),m=e.prop(r,"display_icon_button_wrapper_top_corner",12,!1),E=e.prop(r,"playback_position",12,0),L=null,g=null;const I=te();_e(async()=>{a()!==L&&y()!==g&&g!==null&&(L=a(),a(null),await ce(),a(L)),L=a(),g=y()}),e.legacy_pre_effect(()=>e.deep_read_state(a()),()=>{a()&&I("change",a())}),e.legacy_pre_effect_reset();var C={get value(){return a()},set value(t){a(t),e.flush()},get subtitle(){return y()},set subtitle(t){y(t),e.flush()},get label(){return V()},set label(t){V(t),e.flush()},get show_label(){return o()},set show_label(t){o(t),e.flush()},get autoplay(){return P()},set autoplay(t){P(t),e.flush()},get show_share_button(){return x()},set show_share_button(t){x(t),e.flush()},get show_download_button(){return w()},set show_download_button(t){w(t),e.flush()},get loop(){return f()},set loop(t){f(t),e.flush()},get i18n(){return u()},set i18n(t){u(t),e.flush()},get upload(){return c()},set upload(t){c(t),e.flush()},get display_icon_button_wrapper_top_corner(){return m()},set display_icon_button_wrapper_top_corner(t){m(t),e.flush()},get playback_position(){return E()},set playback_position(t){E(t),e.flush()}};e.init();var A=We(),R=e.first_child(A);{let t=e.derived_safe_equal(()=>V()||"Video");me(R,{get show_label(){return o()},get Icon(){return ee},get label(){return e.get(t)}})}var z=e.sibling(R,2);{var v=t=>{pe(t,{unpadded_box:!0,size:"large",children:(s,_)=>{ee(s)},$$slots:{default:!0}})},h=t=>{var s=Oe(),_=e.first_child(s);e.key(_,()=>(e.deep_read_state(a()),e.untrack(()=>a().url)),q=>{{let S=e.derived_safe_equal(()=>(e.deep_read_state(y()),e.untrack(()=>y()?.url)));Fe(q,{get src(){return e.deep_read_state(a()),e.untrack(()=>a().url)},get subtitle(){return e.get(S)},get is_stream(){return e.deep_read_state(a()),e.untrack(()=>a().is_stream)},get autoplay(){return P()},mirror:!1,get label(){return V()},get loop(){return f()},interactive:!1,get upload(){return c()},get i18n(){return u()},get playback_position(){return E()},set playback_position(d){E(d)},$$events:{play(d){e.bubble_event.call(this,r,d)},pause(d){e.bubble_event.call(this,r,d)},stop(d){e.bubble_event.call(this,r,d)},end(d){e.bubble_event.call(this,r,d)},loadedmetadata:()=>{I("load")}},$$legacy:!0})}});var p=e.sibling(_,2),T=e.child(p);be(T,{get display_top_corner(){return m()},children:(q,S)=>{var d=ze(),n=e.first_child(d);{var k=D=>{{let M=e.derived_safe_equal(()=>(e.deep_read_state(a()),e.untrack(()=>a().is_stream?a().url?.replace("playlist.m3u8","playlist-file"):a().url))),H=e.derived_safe_equal(()=>(e.deep_read_state(a()),e.untrack(()=>a().orig_name||a().path)));ye(D,{get href(){return e.get(M)},get download(){return e.get(H)},children:(j,B)=>{$(j,{get Icon(){return we},label:"Download"})},$$slots:{default:!0}})}};e.if(n,D=>{w()&&D(k)})}var X=e.sibling(n,2);{var b=D=>{ke(D,{get i18n(){return u()},get value(){return a()},formatter:async M=>M?await xe(M.data):"",$$events:{error(M){e.bubble_event.call(this,r,M)},share(M){e.bubble_event.call(this,r,M)}}})};e.if(X,D=>{x()&&D(b)})}e.append(q,d)},$$slots:{default:!0}}),e.reset(p),e.append(t,s)};e.if(z,t=>{e.deep_read_state(a()),e.untrack(()=>!a()||a().url===void 0)?t(v):t(h,!1)})}return e.append(W,A),e.pop(C)}const lt=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));export{Fe as P,Ne as V,lt as a};
