const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./module-FFb15TvM.js","./module-BTkNA4K1.js","./module-8x-imyhh.js"])))=>i.map(i=>d[i]);
import"./svelte/svelte_internal_flags_async.js";import*as e from"./svelte/svelte_internal_client.js";import{createEventDispatcher as be,onMount as _e,onDestroy as Me,tick as Le}from"./svelte/svelte_svelte.js";import"./i18n-DMKL1Q3B.js";import{f as Q,G as qe}from"./utils.svelte-Ceck75cM.js";import{a as Ce,S as ke}from"./StreamingBar-DrfQmzG9.js";import{s as We,u as he,W as ze,p as De,A as Fe,S as Ne}from"./StaticAudio-BV9uoacV.js";import"./svelte/svelte_internal_flags_legacy.js";import{M as Pe,U as Ge}from"./ModifyUpload-CMHuWP2V.js";import{_ as Se,p as He}from"./index-BXZmp9-u.js";import{x as Ve,H as Ye,b as Je,v as Ke,o as Qe,B as Ae,U as Xe}from"./IconButtonWrapper-BWheMLkN.js";function fe(T,t,s,i){return new(s||(s=Promise))((function(u,r){function n(p){try{h(i.next(p))}catch(d){r(d)}}function _(p){try{h(i.throw(p))}catch(d){r(d)}}function h(p){var d;p.done?u(p.value):(d=p.value,d instanceof s?d:new s((function(l){l(d)}))).then(n,_)}h((i=i.apply(T,[])).next())}))}class Be{constructor(){this.listeners={}}on(t,s,i){if(this.listeners[t]||(this.listeners[t]=new Set),i?.once){const u=(...r)=>{this.un(t,u),s(...r)};return this.listeners[t].add(u),()=>this.un(t,u)}return this.listeners[t].add(s),()=>this.un(t,s)}un(t,s){var i;(i=this.listeners[t])===null||i===void 0||i.delete(s)}once(t,s){return this.on(t,s,{once:!0})}unAll(){this.listeners={}}emit(t,...s){this.listeners[t]&&this.listeners[t].forEach((i=>i(...s)))}}class Ze extends Be{constructor(t){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=t}onInit(){}_init(t){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t=>t())),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}}class $e extends Be{constructor(){super(...arguments),this.animationFrameId=null,this.isRunning=!1}start(){if(this.isRunning)return;this.isRunning=!0;const t=()=>{this.isRunning&&(this.emit("tick"),this.animationFrameId=requestAnimationFrame(t))};t()}stop(){this.isRunning=!1,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}destroy(){this.stop()}}const et=["audio/webm","audio/wav","audio/mpeg","audio/mp4","audio/mp3"];class de extends Ze{constructor(t){var s,i,u,r,n,_;super(Object.assign(Object.assign({},t),{audioBitsPerSecond:(s=t.audioBitsPerSecond)!==null&&s!==void 0?s:128e3,scrollingWaveform:(i=t.scrollingWaveform)!==null&&i!==void 0&&i,scrollingWaveformWindow:(u=t.scrollingWaveformWindow)!==null&&u!==void 0?u:5,continuousWaveform:(r=t.continuousWaveform)!==null&&r!==void 0&&r,renderRecordedAudio:(n=t.renderRecordedAudio)===null||n===void 0||n,mediaRecorderTimeslice:(_=t.mediaRecorderTimeslice)!==null&&_!==void 0?_:void 0})),this.stream=null,this.mediaRecorder=null,this.dataWindow=null,this.isWaveformPaused=!1,this.lastStartTime=0,this.lastDuration=0,this.duration=0,this.micStream=null,this.recordedBlobUrl=null,this.timer=new $e,this.subscriptions.push(this.timer.on("tick",(()=>{const h=performance.now()-this.lastStartTime;this.duration=this.isPaused()?this.duration:this.lastDuration+h,this.emit("record-progress",this.duration)})))}static create(t){return new de(t||{})}renderMicStream(t){var s;const i=new AudioContext,u=i.createMediaStreamSource(t),r=i.createAnalyser();u.connect(r),this.options.continuousWaveform&&(r.fftSize=32);const n=r.frequencyBinCount,_=new Float32Array(n);let h=0;this.wavesurfer&&((s=this.originalOptions)!==null&&s!==void 0||(this.originalOptions=Object.assign({},this.wavesurfer.options)),this.wavesurfer.options.interact=!1,this.options.scrollingWaveform&&(this.wavesurfer.options.cursorWidth=0));const p=setInterval((()=>{var d,l,g,y;if(!this.isWaveformPaused){if(r.getFloatTimeDomainData(_),this.options.scrollingWaveform){const m=Math.floor((this.options.scrollingWaveformWindow||0)*i.sampleRate),v=Math.min(m,this.dataWindow?this.dataWindow.length+n:n),R=new Float32Array(m);if(this.dataWindow){const W=Math.max(0,m-this.dataWindow.length);R.set(this.dataWindow.slice(-v+n),W)}R.set(_,m-n),this.dataWindow=R}else if(this.options.continuousWaveform){if(!this.dataWindow){const v=this.options.continuousWaveformDuration?Math.round(100*this.options.continuousWaveformDuration):((l=(d=this.wavesurfer)===null||d===void 0?void 0:d.getWidth())!==null&&l!==void 0?l:0)*window.devicePixelRatio;this.dataWindow=new Float32Array(v)}let m=0;for(let v=0;v<n;v++){const R=Math.abs(_[v]);R>m&&(m=R)}if(h+1>this.dataWindow.length){const v=new Float32Array(2*this.dataWindow.length);v.set(this.dataWindow,0),this.dataWindow=v}this.dataWindow[h]=m,h++}else this.dataWindow=_;if(this.wavesurfer){const m=((y=(g=this.dataWindow)===null||g===void 0?void 0:g.length)!==null&&y!==void 0?y:0)/100;this.wavesurfer.load("",[this.dataWindow],this.options.scrollingWaveform?this.options.scrollingWaveformWindow:m).then((()=>{this.wavesurfer&&this.options.continuousWaveform&&(this.wavesurfer.setTime(this.getDuration()/1e3),this.wavesurfer.options.minPxPerSec||this.wavesurfer.setOptions({minPxPerSec:this.wavesurfer.getWidth()/this.wavesurfer.getDuration()}))})).catch((v=>{console.error("Error rendering real-time recording data:",v)}))}}}),10);return{onDestroy:()=>{clearInterval(p),u?.disconnect(),i?.close()},onEnd:()=>{this.isWaveformPaused=!0,this.stopMic()}}}startMic(t){return fe(this,void 0,void 0,(function*(){let s;this.micStream&&this.stopMic();try{s=yield navigator.mediaDevices.getUserMedia({audio:t==null||t})}catch(u){throw new Error("Error accessing the microphone: "+u.message)}const i=this.renderMicStream(s);return this.micStream=i,this.unsubscribeDestroy=this.once("destroy",i.onDestroy),this.unsubscribeRecordEnd=this.once("record-end",i.onEnd),this.stream=s,s}))}stopMic(){var t,s,i;(t=this.micStream)===null||t===void 0||t.onDestroy(),(s=this.unsubscribeDestroy)===null||s===void 0||s.call(this),(i=this.unsubscribeRecordEnd)===null||i===void 0||i.call(this),this.micStream=null,this.unsubscribeDestroy=void 0,this.unsubscribeRecordEnd=void 0,this.stream&&(this.stream.getTracks().forEach((u=>u.stop())),this.stream=null,this.mediaRecorder=null)}startRecording(t){return fe(this,void 0,void 0,(function*(){const s=this.stream||(yield this.startMic(t));this.dataWindow=null;const i=this.mediaRecorder||new MediaRecorder(s,{mimeType:this.options.mimeType||et.find((n=>MediaRecorder.isTypeSupported(n))),audioBitsPerSecond:this.options.audioBitsPerSecond});this.mediaRecorder=i,this.stopRecording();const u=[];i.ondataavailable=n=>{n.data.size>0&&u.push(n.data),this.emit("record-data-available",n.data)};const r=n=>{var _;const h=new Blob(u,{type:i.mimeType});this.emit(n,h),this.options.renderRecordedAudio&&(this.applyOriginalOptionsIfNeeded(),this.recordedBlobUrl&&URL.revokeObjectURL(this.recordedBlobUrl),this.recordedBlobUrl=URL.createObjectURL(h),(_=this.wavesurfer)===null||_===void 0||_.load(this.recordedBlobUrl))};i.onpause=()=>r("record-pause"),i.onstop=()=>r("record-end"),i.start(this.options.mediaRecorderTimeslice),this.lastStartTime=performance.now(),this.lastDuration=0,this.duration=0,this.isWaveformPaused=!1,this.timer.start(),this.emit("record-start")}))}getDuration(){return this.duration}isRecording(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)==="recording"}isPaused(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)==="paused"}isActive(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)!=="inactive"}stopRecording(){var t;this.isActive()&&((t=this.mediaRecorder)===null||t===void 0||t.stop(),this.timer.stop())}pauseRecording(){var t,s;this.isRecording()&&(this.isWaveformPaused=!0,(t=this.mediaRecorder)===null||t===void 0||t.requestData(),(s=this.mediaRecorder)===null||s===void 0||s.pause(),this.timer.stop(),this.lastDuration=this.duration)}resumeRecording(){var t;this.isPaused()&&(this.isWaveformPaused=!1,(t=this.mediaRecorder)===null||t===void 0||t.resume(),this.timer.start(),this.lastStartTime=performance.now(),this.emit("record-resume"))}static getAvailableAudioDevices(){return fe(this,void 0,void 0,(function*(){return navigator.mediaDevices.enumerateDevices().then((t=>t.filter((s=>s.kind==="audioinput"))))}))}destroy(){this.applyOriginalOptionsIfNeeded(),super.destroy(),this.stopRecording(),this.stopMic(),this.recordedBlobUrl&&(URL.revokeObjectURL(this.recordedBlobUrl),this.recordedBlobUrl=null)}applyOriginalOptionsIfNeeded(){this.wavesurfer&&this.originalOptions&&(this.wavesurfer.setOptions(this.originalOptions),delete this.originalOptions)}}var tt=e.from_html("<option> </option>"),rt=e.from_html("<option> </option>"),st=e.from_html('<select class="mic-select svelte-ym1wxn" aria-label="Select input device"><!></select>');function Ue(T,t){e.push(t,!1);let s=e.prop(t,"i18n",12),i=e.prop(t,"micDevices",28,()=>[]);const u=be();e.legacy_pre_effect(()=>e.deep_read_state(s()),()=>{if(typeof window<"u")try{let d=[];de.getAvailableAudioDevices().then(l=>{i(l),l.forEach(g=>{g.deviceId&&d.push(g)}),i(d)})}catch(d){throw d instanceof DOMException&&d.name=="NotAllowedError"&&u("error",s()("audio.allow_recording_access")),d}}),e.legacy_pre_effect_reset();var r={get i18n(){return s()},set i18n(d){s(d),e.flush()},get micDevices(){return i()},set micDevices(d){i(d),e.flush()}};e.init();var n=st(),_=e.child(n);{var h=d=>{var l=tt(),g=e.child(l,!0);e.reset(l),l.value=l.__value="",e.template_effect(y=>e.set_text(g,y),[()=>(e.deep_read_state(s()),e.untrack(()=>s()("audio.no_microphone")))]),e.append(d,l)},p=d=>{var l=e.comment(),g=e.first_child(l);e.each(g,1,i,e.index,(y,m)=>{var v=rt(),R=e.child(v,!0);e.reset(v);var W={};e.template_effect(()=>{e.set_text(R,(e.get(m),e.untrack(()=>e.get(m).label))),W!==(W=(e.get(m),e.untrack(()=>e.get(m).deviceId)))&&(v.value=(v.__value=(e.get(m),e.untrack(()=>e.get(m).deviceId)))??"")}),e.append(y,v)}),e.append(d,l)};e.if(_,d=>{e.deep_read_state(i()),e.untrack(()=>i().length===0)?d(h):d(p,!1)})}return e.reset(n),e.template_effect(()=>n.disabled=(e.deep_read_state(i()),e.untrack(()=>i().length===0))),e.append(T,n),e.pop(r)}var at=e.from_html('<time class="duration-button duration svelte-1xuh0j1"> </time>'),it=e.from_html('<div class="controls svelte-1xuh0j1"><div class="wrapper svelte-1xuh0j1"><button class="record record-button svelte-1xuh0j1"> </button> <button> </button> <button id="stop-paused" class="stop-button-paused svelte-1xuh0j1"> </button> <button aria-label="pause" class="pause-button svelte-1xuh0j1"><!></button> <button class="resume-button svelte-1xuh0j1"> </button> <!></div> <!></div>');function ot(T,t){e.push(t,!1);let s=e.prop(t,"record",12),i=e.prop(t,"i18n",12),u=e.prop(t,"recording",12,!1),r=e.mutable_source([]),n=e.mutable_source(),_=e.mutable_source(),h=e.mutable_source(),p=e.mutable_source(),d=e.mutable_source(),l=e.mutable_source(!1),g=e.prop(t,"record_time",12),y=e.prop(t,"show_recording_waveform",12),m=e.prop(t,"timing",12,!1);const v=()=>{e.mutate(n,e.get(n).style.display="none"),e.mutate(p,e.get(p).style.display="flex"),e.mutate(_,e.get(_).style.display="block")},R=()=>{s().isPaused()&&(s().resumeRecording(),s().stopRecording()),s().stopMic(),e.mutate(n,e.get(n).style.display="flex"),e.mutate(p,e.get(p).style.display="none"),e.mutate(_,e.get(_).style.display="none"),e.mutate(n,e.get(n).disabled=!1)},W=()=>{e.mutate(_,e.get(_).style.display="none"),e.mutate(h,e.get(h).style.display="block"),e.mutate(p,e.get(p).style.display="none"),e.mutate(d,e.get(d).style.display="flex")},U=()=>{e.mutate(_,e.get(_).style.display="block"),e.mutate(h,e.get(h).style.display="none"),e.mutate(n,e.get(n).style.display="none"),e.mutate(p,e.get(p).style.display="flex"),e.mutate(d,e.get(d).style.display="none")};_e(()=>{s().on("record-start",v),s().on("record-end",R),s().on("record-pause",W),s().on("record-resume",U)}),Me(()=>{s().un("record-start",v),s().un("record-end",R),s().un("record-pause",W),s().un("record-resume",U)}),e.legacy_pre_effect(()=>(e.deep_read_state(u()),e.get(l),e.deep_read_state(s())),()=>{u()&&!e.get(l)?s().startMic().then(()=>{s().startRecording(),e.set(l,!0)}):!u()&&e.get(l)&&(s().isPaused()&&s().resumeRecording(),s().stopRecording(),e.set(l,!1))}),e.legacy_pre_effect_reset();var F={get record(){return s()},set record(f){s(f),e.flush()},get i18n(){return i()},set i18n(f){i(f),e.flush()},get recording(){return u()},set recording(f){u(f),e.flush()},get record_time(){return g()},set record_time(f){g(f),e.flush()},get show_recording_waveform(){return y()},set show_recording_waveform(f){y(f),e.flush()},get timing(){return m()},set timing(f){m(f),e.flush()}};e.init();var E=it(),q=e.child(E),x=e.child(q),M=e.child(x,!0);e.reset(x),e.bind_this(x,f=>e.set(n,f),()=>e.get(n));var c=e.sibling(x,2),b=e.child(c,!0);e.reset(c),e.bind_this(c,f=>e.set(p,f),()=>e.get(p));var A=e.sibling(c,2),B=e.child(A,!0);e.reset(A),e.bind_this(A,f=>e.set(d,f),()=>e.get(d));var I=e.sibling(A,2),O=e.child(I);Ve(O),e.reset(I),e.bind_this(I,f=>e.set(_,f),()=>e.get(_));var k=e.sibling(I,2),w=e.child(k,!0);e.reset(k),e.bind_this(k,f=>e.set(h,f),()=>e.get(h));var D=e.sibling(k,2);{var z=f=>{var H=at(),X=e.child(H,!0);e.reset(H),e.template_effect(()=>e.set_text(X,g())),e.append(f,H)};e.if(D,f=>{m()&&!y()&&f(z)})}e.reset(q);var N=e.sibling(q,2);return Ue(N,{get i18n(){return i()},get micDevices(){return e.get(r)},set micDevices(f){e.set(r,f)},$$legacy:!0}),e.reset(E),e.template_effect((f,H,X,ee,ae)=>{e.set_text(M,f),e.set_class(c,1,`stop-button ${H??""}`,"svelte-1xuh0j1"),e.set_text(b,X),e.set_text(B,ee),e.set_text(w,ae)},[()=>(e.deep_read_state(i()),e.untrack(()=>i()("audio.record"))),()=>(e.deep_read_state(s()),e.untrack(()=>s().isPaused()?"stop-button-paused":"")),()=>(e.deep_read_state(i()),e.untrack(()=>i()("audio.stop"))),()=>(e.deep_read_state(i()),e.untrack(()=>i()("audio.stop"))),()=>(e.deep_read_state(i()),e.untrack(()=>i()("audio.resume")))]),e.event("click",x,()=>s().startRecording()),e.event("click",c,()=>{s().isPaused()&&(s().resumeRecording(),s().stopRecording()),s().stopRecording()}),e.event("click",A,()=>{s().isPaused()&&(s().resumeRecording(),s().stopRecording()),s().stopRecording()}),e.event("click",I,()=>s().pauseRecording()),e.event("click",k,()=>s().resumeRecording()),e.append(T,E),e.pop(F)}var nt=e.from_html('<time class="trim-duration svelte-j9q3sk"> </time>'),lt=e.from_html('<time class="duration svelte-j9q3sk"> </time>'),dt=e.from_html('<time class="duration svelte-j9q3sk">0:00</time>'),ut=e.from_html('<div class="timestamps svelte-j9q3sk"><time class="time svelte-j9q3sk">0:00</time> <div><!> <!></div></div>'),ct=e.from_html('<div class="component-wrapper svelte-j9q3sk"><div class="microphone svelte-j9q3sk" data-testid="microphone-waveform"></div> <div data-testid="recording-waveform"></div> <!> <!> <!></div>');function gt(T,t){e.push(t,!1);let s=e.prop(t,"mode",12),i=e.prop(t,"i18n",12),u=e.prop(t,"dispatch_blob",12),r=e.prop(t,"waveform_settings",12),n=e.prop(t,"waveform_options",28,()=>({show_recording_waveform:!0})),_=e.prop(t,"handle_reset_value",12),h=e.prop(t,"editable",12,!0),p=e.prop(t,"recording",12,!1),d,l=e.mutable_source(),g=e.mutable_source(!1),y=e.mutable_source(),m=e.mutable_source(),v=e.mutable_source(),R=e.mutable_source(null),W=e.mutable_source(),U=e.mutable_source(),F=e.mutable_source(),E=e.mutable_source(0),q,x=e.mutable_source(!1),M=e.mutable_source(0);const c=()=>{clearInterval(q),q=setInterval(()=>{e.update(E)},1e3)},b=be();function A(){if(c(),e.set(x,!0),b("start_recording"),n().show_recording_waveform){let o=e.get(m);o&&(o.style.display="block")}}async function B(o){e.set(E,0),e.set(x,!1),clearInterval(q);try{const S=await o.arrayBuffer(),J=await new AudioContext({sampleRate:r().sampleRate}).decodeAudioData(S);J&&await De(J).then(async re=>{await u()([re],"change"),await u()([re],"stop_recording")})}catch(S){console.error(S)}}let I=e.mutable_source(!1);const O=()=>{e.get(m)&&e.mutate(m,e.get(m).innerHTML=""),d!==void 0&&d.destroy(),e.get(m)&&(d=he.create({...r(),normalize:!1,container:e.get(m)}),e.set(v,d.registerPlugin(de.create())),e.get(v)?.on("record-end",B),e.get(v)?.on("record-start",A),e.get(v)?.on("record-pause",()=>{b("pause_recording"),clearInterval(q)}),e.get(v)?.on("record-end",o=>{e.set(R,URL.createObjectURL(o));const S=e.get(m),j=e.get(y);S&&(S.style.display="none"),j&&e.get(R)&&(j.innerHTML="",k())}),e.set(I,!0))},k=()=>{let o=e.get(y);!e.get(R)||!o||e.set(l,he.create({container:o,url:e.get(R),...r()}))},w=async(o,S)=>{s("edit");const j=e.get(l).getDecodedData();j&&await De(j,o,S).then(async J=>{await u()([J],"change"),await u()([J],"stop_recording"),e.get(l).destroy(),k()}),b("edit")};_e(()=>{O(),window.addEventListener("keydown",o=>{e.get(y)&&e.get(y).contains(document.activeElement)&&(o.key==="ArrowRight"?We(e.get(l),.1):o.key==="ArrowLeft"&&We(e.get(l),-.1))})}),e.legacy_pre_effect(()=>e.get(v),()=>{e.get(v)?.on("record-resume",()=>{c()})}),e.legacy_pre_effect(()=>(e.get(l),e.get(U),Q),()=>{e.get(l)?.on("decode",o=>{e.set(F,o),e.get(U)&&e.mutate(U,e.get(U).textContent=Q(o))})}),e.legacy_pre_effect(()=>(e.get(l),e.get(W),Q),()=>{e.get(l)?.on("timeupdate",o=>e.get(W)&&e.mutate(W,e.get(W).textContent=Q(o)))}),e.legacy_pre_effect(()=>e.get(l),()=>{e.get(l)?.on("pause",()=>{b("pause"),e.set(g,!1)})}),e.legacy_pre_effect(()=>e.get(l),()=>{e.get(l)?.on("play",()=>{b("play"),e.set(g,!0)})}),e.legacy_pre_effect(()=>e.get(l),()=>{e.get(l)?.on("finish",()=>{b("stop"),e.set(g,!1)})}),e.legacy_pre_effect_reset();var D={get mode(){return s()},set mode(o){s(o),e.flush()},get i18n(){return i()},set i18n(o){i(o),e.flush()},get dispatch_blob(){return u()},set dispatch_blob(o){u(o),e.flush()},get waveform_settings(){return r()},set waveform_settings(o){r(o),e.flush()},get waveform_options(){return n()},set waveform_options(o){n(o),e.flush()},get handle_reset_value(){return _()},set handle_reset_value(o){_(o),e.flush()},get editable(){return h()},set editable(o){h(o),e.flush()},get recording(){return p()},set recording(o){p(o),e.flush()}};e.init();var z=ct(),N=e.child(z);e.bind_this(N,o=>e.set(m,o),()=>e.get(m));var f=e.sibling(N,2);e.bind_this(f,o=>e.set(y,o),()=>e.get(y));var H=e.sibling(f,2);{var X=o=>{var S=ut(),j=e.child(S);e.bind_this(j,G=>e.set(W,G),()=>e.get(W));var J=e.sibling(j,2),re=e.child(J);{var ue=G=>{var V=nt(),Z=e.child(V,!0);e.reset(V),e.template_effect($=>e.set_text(Z,$),[()=>(e.deep_read_state(Q),e.get(M),e.untrack(()=>Q(e.get(M))))]),e.append(G,V)};e.if(re,G=>{s()==="edit"&&e.get(M)>0&&G(ue)})}var ie=e.sibling(re,2);{var pe=G=>{var V=lt(),Z=e.child(V,!0);e.reset(V),e.template_effect($=>e.set_text(Z,$),[()=>(e.deep_read_state(Q),e.get(E),e.untrack(()=>Q(e.get(E))))]),e.append(G,V)},ce=G=>{var V=dt();e.bind_this(V,Z=>e.set(U,Z),()=>e.get(U)),e.append(G,V)};e.if(ie,G=>{e.get(x)?G(pe):G(ce,!1)})}e.reset(J),e.reset(S),e.append(o,S)};e.if(H,o=>{e.get(x),e.get(R),e.deep_read_state(n()),e.untrack(()=>(e.get(x)||e.get(R))&&n().show_recording_waveform)&&o(X)})}var ee=e.sibling(H,2);{var ae=o=>{{let S=e.derived_safe_equal(()=>(e.deep_read_state(Q),e.get(E),e.untrack(()=>Q(e.get(E)))));ot(o,{get i18n(){return i()},get timing(){return e.get(x)},get recording(){return p()},get show_recording_waveform(){return e.deep_read_state(n()),e.untrack(()=>n().show_recording_waveform)},get record_time(){return e.get(S)},get record(){return e.get(v)},set record(j){e.set(v,j)},$$legacy:!0})}};e.if(ee,o=>{e.get(m)&&!e.get(R)&&e.get(I)&&o(ae)})}var te=e.sibling(ee,2);{var we=o=>{ze(o,{get container(){return e.get(y)},get playing(){return e.get(g)},get audio_duration(){return e.get(F)},get i18n(){return i()},get editable(){return h()},interactive:!0,handle_trim_audio:w,show_redo:!0,get handle_reset_value(){return _()},get waveform_options(){return n()},get waveform(){return e.get(l)},set waveform(S){e.set(l,S)},get trimDuration(){return e.get(M)},set trimDuration(S){e.set(M,S)},get mode(){return s()},set mode(S){s(S)},$$legacy:!0})};e.if(te,o=>{e.get(l)&&e.get(R)&&o(we)})}return e.reset(z),e.append(T,z),e.pop(D)}var _t=e.from_html('<div class="svelte-m6ymia"></div>'),pt=e.from_html('<button><span class="record-icon svelte-m6ymia"><span class="pinger svelte-m6ymia"></span> <span class="dot svelte-m6ymia"></span></span> </button>'),mt=e.from_html('<button class="spinner-button svelte-m6ymia"><div class="icon svelte-m6ymia"><!></div> </button>'),vt=e.from_html('<button class="record-button svelte-m6ymia"><span class="record-icon svelte-m6ymia"><span class="dot svelte-m6ymia"></span></span> </button>'),ft=e.from_html('<div class="mic-wrap svelte-m6ymia"><!> <div class="controls svelte-m6ymia"><!> <!></div></div>');function ht(T,t){e.push(t,!1);let s=e.prop(t,"recording",12,!1),i=e.prop(t,"paused_recording",12,!1),u=e.prop(t,"stop",12),r=e.prop(t,"record",12),n=e.prop(t,"i18n",12),_=e.prop(t,"waveform_settings",12),h=e.prop(t,"waveform_options",28,()=>({show_recording_waveform:!0})),p=e.prop(t,"waiting",12,!1),d,l=e.mutable_source(),g=e.mutable_source(),y=e.mutable_source([]);_e(()=>{m()});const m=()=>{d!==void 0&&d.destroy(),e.get(g)&&(d=he.create({..._(),normalize:!1,container:e.get(g)}),e.set(l,d.registerPlugin(de.create())))};var v={get recording(){return s()},set recording(c){s(c),e.flush()},get paused_recording(){return i()},set paused_recording(c){i(c),e.flush()},get stop(){return u()},set stop(c){u(c),e.flush()},get record(){return r()},set record(c){r(c),e.flush()},get i18n(){return n()},set i18n(c){n(c),e.flush()},get waveform_settings(){return _()},set waveform_settings(c){_(c),e.flush()},get waveform_options(){return h()},set waveform_options(c){h(c),e.flush()},get waiting(){return p()},set waiting(c){p(c),e.flush()}};e.init();var R=ft(),W=e.child(R);{var U=c=>{var b=_t();let A;e.bind_this(b,B=>e.set(g,B),()=>e.get(g)),e.template_effect(()=>A=e.set_style(b,"",A,{display:s()?"block":"none"})),e.append(c,b)};e.if(W,c=>{e.deep_read_state(h()),e.untrack(()=>h().show_recording_waveform)&&c(U)})}var F=e.sibling(W,2),E=e.child(F);{var q=c=>{var b=pt(),A=e.sibling(e.child(b));e.reset(b),e.template_effect(B=>{e.set_class(b,1,e.clsx(i()?"stop-button-paused":"stop-button"),"svelte-m6ymia"),e.set_text(A,` ${B??""}`)},[()=>(e.deep_read_state(i()),e.deep_read_state(n()),e.untrack(()=>i()?n()("audio.pause"):n()("audio.stop")))]),e.event("click",b,()=>{e.get(l)?.stopMic(),u()()}),e.append(c,b)},x=c=>{var b=e.comment(),A=e.first_child(b);{var B=O=>{var k=mt(),w=e.child(k),D=e.child(w);Ye(D),e.reset(w);var z=e.sibling(w);e.reset(k),e.template_effect(N=>e.set_text(z,` ${N??""}`),[()=>(e.deep_read_state(n()),e.untrack(()=>n()("audio.waiting")))]),e.event("click",k,()=>{u()()}),e.append(O,k)},I=O=>{var k=vt(),w=e.sibling(e.child(k));e.reset(k),e.template_effect(D=>e.set_text(w,` ${D??""}`),[()=>(e.deep_read_state(n()),e.untrack(()=>n()("audio.record")))]),e.event("click",k,()=>{e.get(l)?.startMic(),r()()}),e.append(O,k)};e.if(A,O=>{s()&&p()?O(B):O(I,!1)},!0)}e.append(c,b)};e.if(E,c=>{s()&&!p()?c(q):c(x,!1)})}var M=e.sibling(E,2);return Ue(M,{get i18n(){return n()},get micDevices(){return e.get(y)},set micDevices(c){e.set(y,c)},$$legacy:!0}),e.reset(F),e.reset(R),e.append(T,R),e.pop(v)}let Ee;async function bt(){const{MediaRecorder:T,register:t}=await Se(async()=>{const{MediaRecorder:i,register:u}=await import("./module-FFb15TvM.js");return{MediaRecorder:i,register:u}},__vite__mapDeps([0,1]),import.meta.url),{connect:s}=await Se(async()=>{const{connect:i}=await import("./module-8x-imyhh.js");return{connect:i}},__vite__mapDeps([2,1]),import.meta.url);return t(await s()),Ee=T,Ee}var wt=e.from_html("<!> <!>",1),yt=e.from_html("<!> <!>",1),Rt=e.from_html("<!> <div><!> <!> <!></div>",1);function xt(T,t){e.push(t,!1);let s=e.prop(t,"value",12,null),i=e.prop(t,"subtitles",12,null),u=e.prop(t,"label",12),r=e.prop(t,"root",12),n=e.prop(t,"loop",12),_=e.prop(t,"show_label",12,!0),h=e.prop(t,"buttons",28,()=>["download","share"]),p=e.prop(t,"sources",28,()=>["microphone","upload"]),d=e.prop(t,"pending",12,!1),l=e.prop(t,"streaming",12,!1),g=e.prop(t,"i18n",12),y=e.prop(t,"waveform_settings",12),m=e.prop(t,"trim_region_settings",28,()=>({})),v=e.prop(t,"waveform_options",28,()=>({})),R=e.prop(t,"dragging",12),W=e.prop(t,"active_source",12),U=e.prop(t,"handle_reset_value",12,()=>{}),F=e.prop(t,"editable",12,!0),E=e.prop(t,"max_file_size",12,null),q=e.prop(t,"upload",12),x=e.prop(t,"stream_handler",12),M=e.prop(t,"stream_every",12,.1),c=e.prop(t,"uploading",12,!1),b=e.prop(t,"recording",12,!1),A=e.prop(t,"class_name",12,""),B=e.prop(t,"upload_promise",12,null),I=e.prop(t,"initial_value",12,null),O=e.prop(t,"playback_position",12,0),k=e.prop(t,"time_limit",12,null),w=e.prop(t,"stream_state",12,"closed"),D=e.mutable_source(),z=e.mutable_source(""),N=e.mutable_source(void 0),f=e.mutable_source([]),H=e.mutable_source(!1),X=!1,ee;const ae=44;let te=[];typeof window<"u"&&l()&&bt().then(a=>{ee=a});const o=be(),S=a=>a.map(P=>P instanceof Blob?P:P.slice()),j=async(a,P)=>{let Y=new File(S(a),"audio.wav",{type:"audio/wav"});if(Y.size===0)return;const se=await He([Y],P==="stream");I(s()),s((await q()(se,r(),void 0,E()||void 0))?.filter(Boolean)[0]),o(P,s())};Me(()=>{l()&&e.get(D)&&e.get(D).state!=="inactive"&&e.get(D).stop()});async function J(){let a;try{a=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(P){if(!navigator.mediaDevices){o("error",g()("audio.no_device_support"));return}if(P instanceof DOMException&&P.name=="NotAllowedError"){o("error",g()("audio.allow_recording_access"));return}throw P}a!=null&&(l()?(e.set(D,new ee(a,{mimeType:"audio/wav"})),e.get(D).addEventListener("dataavailable",re)):(e.set(D,new MediaRecorder(a)),e.get(D).addEventListener("dataavailable",P=>{te.push(P.data)})),e.get(D).addEventListener("stop",async()=>{b(!1),e.get(D).stop(),await j(te,"change"),await j(te,"stop_recording"),te=[]}),X=!0)}async function re(a){let P=await a.data.arrayBuffer(),Y=new Uint8Array(P);if(e.get(N)||(e.set(N,new Uint8Array(P.slice(0,ae))),Y=new Uint8Array(P.slice(ae))),d())e.get(f).push(Y);else{let se=[e.get(N)].concat(e.get(f),[Y]);if(!b()||w()==="waiting")return;j(se,"stream"),e.set(f,[])}}async function ue(){b(!0),o("start_recording"),X||await J(),e.set(N,void 0),l()&&e.get(D).state!="recording"&&e.get(D).start(M()*1e3)}function ie(){o("change",null),o("clear"),e.set(z,""),s(null)}function pe({detail:a}){s(a),o("change",a),o("upload",a)}async function ce(){b(!1),l()&&(o("close_stream"),o("stop_recording"),e.get(D).stop(),d()&&e.set(H,!0),j(te,"stop_recording"),o("clear"),e.set(z,""))}e.legacy_pre_effect(()=>e.deep_read_state(R()),()=>{o("drag",R())}),e.legacy_pre_effect(()=>(e.get(H),e.deep_read_state(d()),e.get(N),e.get(f)),()=>{if(e.get(H)&&d()===!1&&(e.set(H,!1),e.get(N)&&e.get(f))){let a=[e.get(N)].concat(e.get(f));e.set(f,[]),j(a,"stream")}}),e.legacy_pre_effect(()=>(e.deep_read_state(b()),e.get(D)),()=>{!b()&&e.get(D)&&ce()}),e.legacy_pre_effect(()=>(e.deep_read_state(b()),e.get(D)),()=>{b()&&e.get(D)&&ue()}),e.legacy_pre_effect_reset();var G={get value(){return s()},set value(a){s(a),e.flush()},get subtitles(){return i()},set subtitles(a){i(a),e.flush()},get label(){return u()},set label(a){u(a),e.flush()},get root(){return r()},set root(a){r(a),e.flush()},get loop(){return n()},set loop(a){n(a),e.flush()},get show_label(){return _()},set show_label(a){_(a),e.flush()},get buttons(){return h()},set buttons(a){h(a),e.flush()},get sources(){return p()},set sources(a){p(a),e.flush()},get pending(){return d()},set pending(a){d(a),e.flush()},get streaming(){return l()},set streaming(a){l(a),e.flush()},get i18n(){return g()},set i18n(a){g(a),e.flush()},get waveform_settings(){return y()},set waveform_settings(a){y(a),e.flush()},get trim_region_settings(){return m()},set trim_region_settings(a){m(a),e.flush()},get waveform_options(){return v()},set waveform_options(a){v(a),e.flush()},get dragging(){return R()},set dragging(a){R(a),e.flush()},get active_source(){return W()},set active_source(a){W(a),e.flush()},get handle_reset_value(){return U()},set handle_reset_value(a){U(a),e.flush()},get editable(){return F()},set editable(a){F(a),e.flush()},get max_file_size(){return E()},set max_file_size(a){E(a),e.flush()},get upload(){return q()},set upload(a){q(a),e.flush()},get stream_handler(){return x()},set stream_handler(a){x(a),e.flush()},get stream_every(){return M()},set stream_every(a){M(a),e.flush()},get uploading(){return c()},set uploading(a){c(a),e.flush()},get recording(){return b()},set recording(a){b(a),e.flush()},get class_name(){return A()},set class_name(a){A(a),e.flush()},get upload_promise(){return B()},set upload_promise(a){B(a),e.flush()},get initial_value(){return I()},set initial_value(a){I(a),e.flush()},get playback_position(){return O()},set playback_position(a){O(a),e.flush()},get time_limit(){return k()},set time_limit(a){k(a),e.flush()},get stream_state(){return w()},set stream_state(a){w(a),e.flush()}};e.init();var V=Rt(),Z=e.first_child(V);{let a=e.derived_safe_equal(()=>W()==="upload"&&s()===null),P=e.derived_safe_equal(()=>(e.deep_read_state(u()),e.deep_read_state(g()),e.untrack(()=>u()||g()("audio.audio"))));Je(Z,{get show_label(){return _()},get Icon(){return Ke},get float(){return e.get(a)},get label(){return e.get(P)}})}var $=e.sibling(Z,2),ye=e.child($);Ce(ye,{get time_limit(){return k()}});var Re=e.sibling(ye,2);{var Ie=a=>{var P=e.comment(),Y=e.first_child(P);{var se=L=>{var ne=wt(),ge=e.first_child(ne);Pe(ge,{get i18n(){return g()},$$events:{clear:ie}});var me=e.sibling(ge,2);{var le=C=>{{let K=e.derived_safe_equal(()=>w()==="waiting");ht(C,{record:ue,get recording(){return b()},stop:ce,get i18n(){return g()},get waveform_settings(){return y()},get waveform_options(){return v()},get waiting(){return e.get(K)}})}},ve=C=>{gt(C,{get i18n(){return g()},get editable(){return F()},get recording(){return b()},dispatch_blob:j,get waveform_settings(){return y()},get waveform_options(){return v()},get handle_reset_value(){return U()},get mode(){return e.get(z)},set mode(K){e.set(z,K)},$$events:{start_recording(K){e.bubble_event.call(this,t,K)},pause_recording(K){e.bubble_event.call(this,t,K)},stop_recording(K){e.bubble_event.call(this,t,K)}},$$legacy:!0})};e.if(me,C=>{l()?C(le):C(ve,!1)})}e.append(L,ne)},oe=L=>{var ne=e.comment(),ge=e.first_child(ne);{var me=le=>{{let ve=e.derived_safe_equal(()=>(e.deep_read_state(g()),e.untrack(()=>g()("audio.drop_to_upload"))));Ge(le,{filetype:"audio/aac,audio/midi,audio/mpeg,audio/ogg,audio/wav,audio/x-wav,audio/opus,audio/webm,audio/flac,audio/vnd.rn-realaudio,audio/x-ms-wma,audio/x-aiff,audio/amr,audio/*",get root(){return r()},get max_file_size(){return E()},get upload(){return q()},get stream_handler(){return x()},get aria_label(){return e.get(ve)},get upload_promise(){return B()},set upload_promise(C){B(C)},get dragging(){return R()},set dragging(C){R(C)},get uploading(){return c()},set uploading(C){c(C)},$$events:{load:pe,error:({detail:C})=>o("error",C)},children:(C,K)=>{var xe=e.comment(),Te=e.first_child(xe);e.slot(Te,t,"default",{},null),e.append(C,xe)},$$slots:{default:!0},$$legacy:!0})}};e.if(ge,le=>{W()==="upload"&&le(me)},!0)}e.append(L,ne)};e.if(Y,L=>{W()==="microphone"?L(se):L(oe,!1)})}e.append(a,P)},Oe=a=>{var P=yt(),Y=e.first_child(P);{let oe=e.derived_safe_equal(()=>(e.deep_read_state(h()),e.deep_read_state(s()),e.untrack(()=>h()===null||h().includes("download")?s().url:null)));Pe(Y,{get i18n(){return g()},get download(){return e.get(oe)},$$events:{clear:ie,edit:()=>e.set(z,"edit")}})}var se=e.sibling(Y,2);{let oe=e.derived_safe_equal(()=>(e.deep_read_state(i()),e.untrack(()=>Array.isArray(i())?i():i()?.url)));Fe(se,{get value(){return s()},get subtitles(){return e.get(oe)},get label(){return u()},get i18n(){return g()},dispatch_blob:j,get waveform_settings(){return y()},get waveform_options(){return v()},get trim_region_settings(){return m()},get handle_reset_value(){return U()},get editable(){return F()},get loop(){return n()},interactive:!0,get mode(){return e.get(z)},set mode(L){e.set(z,L)},get playback_position(){return O()},set playback_position(L){O(L)},$$events:{stop(L){e.bubble_event.call(this,t,L)},play(L){e.bubble_event.call(this,t,L)},pause(L){e.bubble_event.call(this,t,L)},edit(L){e.bubble_event.call(this,t,L)}},$$legacy:!0})}e.append(a,P)};e.if(Re,a=>{s()===null||l()?a(Ie):a(Oe,!1)})}var je=e.sibling(Re,2);return Qe(je,{get sources(){return p()},handle_clear:ie,get active_source(){return W()},set active_source(a){W(a)},$$legacy:!0}),e.reset($),e.template_effect(()=>{e.set_class($,1,`audio-container ${A()??""}`,"svelte-ocxd3m"),e.set_attribute($,"data-testid",u()?"waveform-"+u():"unlabelled-audio")}),e.append(T,V),e.pop(G)}var kt=e.from_html("<!> <!>",1),Wt=e.from_html("<!> <!>",1);function jt(T,t){e.push(t,!0);let s=e.rest_props(t,["$$slots","$$events","$$legacy"]),i=e.state(void 0);t.props.stream_every=.1;class u extends qe{async get_data(){return e.get(i)&&(await e.get(i),await Le()),await super.get_data()}}const r=new u(s);let n=e.derived(()=>r.shared.label||r.i18n("audio.audio")),_=e.derived(()=>t.minimal??r.props.minimal??!1),h=e.derived(()=>r.props.sources?r.props.sources[0]:null),p=r.props.value;const d=()=>{p===null||r.props.value===p||(r.props.value=p)};let l,g="darkorange",y=e.derived(()=>({height:50,barWidth:2,barGap:3,cursorWidth:2,cursorColor:"#ddd5e9",autoplay:r.props.autoplay,barRadius:10,dragToSeek:!0,normalize:!0,minPxPerSec:20}));const m={color:r.props.waveform_options.trim_region_color,drag:!0,resize:!0};function v(){document.documentElement.style.setProperty("--trim-region-color",m.color||g)}function R({detail:x}){const[M,c]=x.includes("Invalid file type")?["warning","complete"]:["error","error"];r.shared.loading_status&&(r.shared.loading_status.status=c,r.shared.loading_status.message=x),r.dispatch(M,x)}let W=e.state(e.proxy(r.props.value));e.user_effect(()=>{e.get(W)!=r.props.value&&(e.set(W,r.props.value,!0),r.dispatch("change"))}),_e(()=>{g=getComputedStyle(document?.documentElement).getPropertyValue("--color-accent"),v(),e.get(y).waveColor=r.props.waveform_options.waveform_color||"#9ca3af",e.get(y).progressColor=r.props.waveform_options.waveform_progress_color||g,e.get(y).mediaControls=r.props.waveform_options.show_controls,e.get(y).sampleRate=r.props.waveform_options.sample_rate||44100});var U=e.comment(),F=e.first_child(U);{var E=x=>{{let M=e.derived(()=>l?"focus":"base");Ae(x,{variant:"solid",get border_mode(){return e.get(M)},padding:!1,allow_overflow:!1,get elem_id(){return r.shared.elem_id},get elem_classes(){return r.shared.elem_classes},get visible(){return r.shared.visible},get container(){return r.shared.container},get scale(){return r.shared.scale},get min_width(){return r.shared.min_width},children:(c,b)=>{var A=kt(),B=e.first_child(A);ke(B,e.spread_props({get autoscroll(){return r.shared.autoscroll},get i18n(){return r.i18n}},()=>r.shared.loading_status,{on_clear_status:()=>r.dispatch("clear_status",r.shared.loading_status)}));var I=e.sibling(B,2);{let O=e.derived(()=>r.props.buttons??["download","share"]);Ne(I,{get i18n(){return r.i18n},get show_label(){return r.shared.show_label},get buttons(){return e.get(O)},get value(){return r.props.value},get subtitles(){return r.props.subtitles},get label(){return e.get(n)},get loop(){return r.props.loop},get waveform_settings(){return e.get(y)},get waveform_options(){return r.props.waveform_options},get editable(){return r.props.editable},get minimal(){return e.get(_)},get playback_position(){return r.props.playback_position},set playback_position(k){r.props.playback_position=k},$$events:{share:k=>r.dispatch("share",k.detail),error:k=>r.dispatch("error",k.detail),play:()=>r.dispatch("play"),pause:()=>r.dispatch("pause"),stop:()=>r.dispatch("stop")}})}e.append(c,A)},$$slots:{default:!0}})}},q=x=>{{let M=e.derived(()=>r.props.value===null&&e.get(h)==="upload"?"dashed":"solid"),c=e.derived(()=>l?"focus":"base");Ae(x,{get variant(){return e.get(M)},get border_mode(){return e.get(c)},padding:!1,allow_overflow:!1,get elem_id(){return r.shared.elem_id},get elem_classes(){return r.shared.elem_classes},get visible(){return r.shared.visible},get container(){return r.shared.container},get scale(){return r.shared.scale},get min_width(){return r.shared.min_width},children:(b,A)=>{var B=Wt(),I=e.first_child(B);ke(I,e.spread_props({get autoscroll(){return r.shared.autoscroll},get i18n(){return r.i18n}},()=>r.shared.loading_status,{on_clear_status:()=>r.dispatch("clear_status",r.shared.loading_status)}));var O=e.sibling(I,2);{let k=e.derived(()=>r.props.buttons??[]);xt(O,{get label(){return e.get(n)},get show_label(){return r.shared.show_label},get buttons(){return e.get(k)},get value(){return r.props.value},get subtitles(){return r.props.subtitles},get root(){return r.shared.root},get sources(){return r.props.sources},get active_source(){return e.get(h)},get pending(){return r.shared.loading_status.pending},get streaming(){return r.props.streaming},get loop(){return r.props.loop},get max_file_size(){return r.shared.max_file_size},handle_reset_value:d,get editable(){return r.props.editable},get i18n(){return r.i18n},get waveform_settings(){return e.get(y)},get waveform_options(){return r.props.waveform_options},get trim_region_settings(){return m},get stream_every(){return r.props.stream_every},get stream_state(){return r.shared.loading_status.stream_state},upload:(...w)=>r.shared.client.upload(...w),stream_handler:(...w)=>r.shared.client.stream(...w),get time_limit(){return r.shared.loading_status.time_limit},get upload_promise(){return e.get(i)},set upload_promise(w){e.set(i,w,!0)},get initial_value(){return p},set initial_value(w){p=w},get recording(){return r.props.recording},set recording(w){r.props.recording=w},get dragging(){return l},set dragging(w){l=w},get playback_position(){return r.props.playback_position},set playback_position(w){r.props.playback_position=w},$$events:{change:({detail:w})=>r.props.value=w,stream:({detail:w})=>{r.props.value=w,r.dispatch("stream",r.props.value)},drag:({detail:w})=>l=w,edit:()=>r.dispatch("edit"),play:()=>r.dispatch("play"),pause:()=>r.dispatch("pause"),stop:()=>r.dispatch("stop"),start_recording:()=>r.dispatch("start_recording"),pause_recording:()=>r.dispatch("pause_recording"),stop_recording:w=>{r.dispatch("stop_recording"),r.dispatch("input")},upload:()=>{r.dispatch("upload"),r.dispatch("input")},clear:()=>{r.dispatch("clear"),r.dispatch("input")},error:R,close_stream:()=>r.dispatch("close_stream","stream")},children:(w,D)=>{Xe(w,{get i18n(){return r.i18n},type:"audio"})},$$slots:{default:!0}})}e.append(b,B)},$$slots:{default:!0}})}};e.if(F,x=>{r.shared.interactive?x(q,!1):x(E)})}e.append(T,U),e.pop()}export{jt as I,xt as a,de as o};
